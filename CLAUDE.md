# Workflow - 작업 관리 시스템

## 프로젝트 개요
건설/현장 작업자를 위한 웹 기반 협업형 작업 관리 애플리케이션입니다.
팀 단위로 작업을 관리하고, 현장별 일정을 추적하며, 최적 이동 경로를 제공하는 것이 핵심 기능입니다.

## 현재 구현된 핵심 기능

### 1. 인증 및 팀 관리
- **계정 시스템**: ID/비밀번호 기반 로그인, 자동 로그인 지원
- **팀 시스템**:
  - 6자리 팀코드를 통한 팀 생성/참여 (예: ABC123)
  - 팀 생성자(creator)와 일반 멤버(member) 역할 구분
  - ID로 직접 팀원 초대 기능
  - 팀원 초대 알림 시스템
- **데이터 마이그레이션**: 개인 작업/현장을 팀 생성 시 자동으로 팀 데이터로 이전

### 2. 작업 관리 (Work Management)
- **작업 추가**: 현장명 + 작업 내용으로 작업 생성
- **시험 작업 자동화**: "시험" 키워드 입력 시 자동으로 관련 일정 생성
  - 시험 당일 → 캡핑(+1영업일) → 탈형(+2영업일) → 7일강도(+7일) → 28일강도(+28일)
- **작업 순서 변경**: 드래그앤드롭으로 작업 우선순위 조정 (PC/모바일 지원)
- **완료 기한 설정**: 오늘/내일/이번주/커스텀 날짜 선택
- **기한 초과 알림**: 기한이 지난 작업은 빨간색으로 표시 + "기한초과" 뱃지
- **담당자 지정**: 드롭다운으로 팀원 할당
- **작업 완료/미완료 토글**: 체크박스 클릭으로 상태 변경
- **작업 삭제**:
  - PC: 🗑️ 버튼 클릭
  - 모바일: 좌측 스와이프로 삭제 버튼 노출

### 3. 현장 관리 (Site Management)
- **현장 등록**: 현장명 + 주소로 현장 저장
- **현장 선택**: 작업 추가 시 "📋 선택" 버튼으로 저장된 현장 빠르게 선택
- **현장 수정/삭제**: 현장 목록에서 편집 및 삭제 가능
- **팀 단위 현장 공유**: 팀원 모두가 동일한 현장 목록 공유

### 4. 지도 및 경로 기능
- **Kakao Map API 연동**: 현장 위치 시각화
- **경로 최적화**:
  - 현재 위치 → 작업 순서대로 현장 방문 경로 표시
  - 총 거리 및 소요 시간 계산
  - Kakao Mobility Directions API 사용 (서버사이드에서 API 키 보호)
- **위치 권한**: 사용자의 현재 위치 기반 경로 생성

### 5. 날짜 네비게이션
- **날짜 이동**: 오늘/이전/다음 버튼으로 날짜별 작업 조회
- **과거 작업 표시**: 선택 날짜 이전의 미완료 작업도 함께 표시
- **날짜별 필터링**: 완료 기한 기준으로 작업 분류

### 6. UI/UX 특성
- **그라디언트 디자인**:
  - 메인 컬러: `#2a459c` → `#5b7fd6` (파란색 계열)
  - 모던하고 전문적인 느낌
- **반응형 디자인**: PC/모바일 모두 지원
- **섹션 접기/펼치기**: 헤더 클릭으로 섹션 토글 가능
- **로딩 인디케이터**: 경로 계산 시 스피너 표시
- **햄버거 메뉴**: 우측 상단 애니메이션 메뉴 버튼
- **모달 시스템**:
  - 현장 관리, 팀 설정, 사용 설명서 등 다양한 모달
  - 오버레이와 함께 사용자 친화적 인터페이스

### 7. 데이터베이스 구조 (Firebase Realtime Database)
```
users/
  {userId}/
    info/
      name, password, currentTeamId
    invitations/
      초대 목록

teams/
  {teamId}/
    info/
      name, teamCode, createdBy, createdAt
    members/
      {userId}: {name, joinedAt, role}
    worklists/
      작업 목록
    sites/
      현장 목록

companies/ (레거시 개인 작업 데이터)
```

## 기술 스택

### Frontend
- **Vanilla JavaScript**: ES6+ 문법 사용
- **HTML5**: 시맨틱 마크업
- **CSS3**:
  - Flexbox/Grid 레이아웃
  - CSS Variables 미사용 (하드코딩된 색상값)
  - 애니메이션 및 트랜지션

### Backend & APIs
- **Firebase**:
  - Realtime Database (실시간 동기화)
  - 클라이언트사이드 SDK
- **Vercel Serverless Functions**: `/api/directions.js`
  - Kakao Mobility API 프록시
  - CORS 처리
- **Kakao Map SDK**: 지도 표시
- **Kakao Mobility Directions API**: 경로 계산

### 배포
- Vercel 호스팅 (추정)

## 코딩 스타일 가이드

### JavaScript
- **들여쓰기**: 스페이스 2칸
- **세미콜론**: 사용
- **함수 정의**: `window.functionName = function() {}` 형식 (전역 함수)
- **비동기 처리**: async/await 패턴 사용
- **에러 처리**: try-catch 블록 필수
- **로깅**: `console.log`, `console.error` 활용 (이모지 포함)
- **변수명**: camelCase 사용
- **주석**: 섹션 구분 시 `// =====` 형식

### HTML
- **들여쓰기**: 스페이스 2칸
- **클래스명**: kebab-case (예: `task-input-container`)
- **한글 텍스트**: UI 라벨 및 메시지는 한글 사용
- **접근성**: autocomplete 속성 활용

### CSS
- **들여쓰기**: 스페이스 4칸
- **색상**:
  - 메인: `#2a459c`, `#5b7fd6`
  - 보조: `#f5f7fa`, `#e0e0e0`
  - 경고: `#f44336`
  - 성공: `#4caf50`
- **반응형 브레이크포인트**: `max-width: 768px` (모바일)
- **애니메이션**: keyframes, transition 적극 활용

## 프로젝트 구조
```
workflow/
├── index.html          # 메인 HTML (모든 UI 포함, 824줄)
├── script.js          # 메인 JavaScript 로직 (매우 큼, 45000+ 토큰)
├── styles.css         # 전체 스타일시트 (1700줄)
├── api/
│   └── directions.js  # Kakao API 프록시 (Vercel Function)
└── README.md          # 프로젝트 문서
```

## 앱 사용 의도 및 개선 방향

### 원래 의도
이 앱은 **건설 현장 관리자나 작업자들이 하루 일과를 효율적으로 계획하고 실행**하도록 돕기 위해 만들어졌습니다:
1. 아침에 출근하면 오늘 방문할 현장과 작업을 정리
2. 작업 우선순위를 드래그로 조정
3. "경로 표시" 버튼으로 최적 이동 경로 확인
4. 현장 방문하며 작업 완료 체크
5. 시험 작업은 자동으로 후속 일정 생성되어 놓칠 일 없음
6. 팀원들과 작업 진행 상황 실시간 공유

### 개선이 필요한 방향

#### 🔴 긴급 개선 필요
1. **성능 최적화**
   - `script.js`가 너무 비대함 (45000+ 토큰)
   - 모듈화 필요: 팀 관리, 작업 관리, 지도 기능 등으로 분리
   - 불필요한 전역 변수 제거

2. **코드 품질**
   - 중복 코드 제거 (모달 토글 함수들 패턴 통일)
   - 매직 넘버/문자열 상수화
   - 에러 메시지 일관성 개선

3. **보안**
   - Firebase API 키가 클라이언트에 노출됨
   - 비밀번호 평문 저장 (해시 처리 필요)
   - Firebase Security Rules 강화 필요

#### 🟡 중요 개선 사항
4. **UX 개선**
   - 작업 순서 변경 후 경로가 자동으로 재계산되지 않음
   - 로딩 상태 피드백 부족한 부분 있음
   - 오프라인 모드 미지원 (PWA 전환 고려)

5. **기능 추가**
   - 작업 히스토리/통계 기능 부재
   - 알림 기능 (기한 임박, 새 초대 등)
   - 작업 템플릿 저장 기능
   - 작업 시간 추적 기능
   - 사진/파일 첨부 기능

6. **데이터 관리**
   - 삭제된 작업 복구 불가 (소프트 삭제 구현)
   - 대량 작업 처리 시 성능 저하 우려
   - 백업/복원 기능 부재

#### 🟢 장기 개선 계획
7. **확장성**
   - TypeScript 마이그레이션
   - React/Vue 등 프레임워크 도입 검토
   - 상태 관리 라이브러리 (Redux, Zustand 등)

8. **협업 기능 강화**
   - 실시간 채팅
   - 작업별 댓글/메모
   - 팀 캘린더 뷰

9. **분석 및 보고**
   - 작업 완료율 대시보드
   - 팀원별 생산성 리포트
   - 현장별 작업 통계

## 개발 시 중요 규칙

### IMPORTANT: Firebase 실시간 데이터 동기화
- Firebase는 실시간 데이터베이스이므로 `dbOnValue` 리스너 사용 시 메모리 누수 주의
- 컴포넌트 언마운트 시 리스너 해제 필수
- 한 번만 읽을 데이터는 `{ onlyOnce: true }` 옵션 사용

### IMPORTANT: 날짜 처리
- 모든 날짜는 ISO 8601 형식 사용 (`new Date().toISOString()`)
- 영업일 계산 로직 존재 (주말 제외)
- 시험 작업 일정 계산 시 영업일 기준

### IMPORTANT: 사용자 경험
- 모든 비동기 작업에는 로딩 인디케이터 표시
- 에러 발생 시 사용자 친화적 메시지 표시 (alert 사용)
- 중요한 액션(삭제, 나가기 등)에는 확인 메시지 필수

### IMPORTANT: 모바일 지원
- 터치 이벤트 처리 (드래그앤드롭, 스와이프)
- 최소 터치 영역 44x44px (접근성)
- 뷰포트 설정 확인 (`viewport` meta 태그)

### IMPORTANT: 팀 데이터 무결성
- 팀 나가기 시 개인 작업으로 복원 로직 필요
- 팀 삭제 시 모든 멤버에게 영향 고려
- 동시 편집 충돌 방지 (Firebase 트랜잭션 사용 고려)

## Git 커밋 메시지 규칙
- `feat:` 새 기능
- `fix:` 버그 수정
- `refactor:` 리팩토링
- `style:` UI/스타일 변경
- `docs:` 문서 수정
- `perf:` 성능 개선

## 자주 사용하는 명령어
```bash
# 로컬 개발 서버 (Live Server 등)
# Firebase 에뮬레이터 (필요시)
# Vercel 배포
vercel --prod
```

## 연락처 정보
- 이메일: support@example.com (예시)
- 카카오톡: @작업관리앱 (예시)

---

**마지막 업데이트**: 2025-11-06
**프로젝트 상태**: 활성 개발 중
**현재 버전**: Beta (배포 환경 운영 중)
