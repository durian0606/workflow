<!DOCTYPE html>

<html lang="ko">
<head>
  <link rel="stylesheet" href="styles.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>작업 관리</title>
  
  <script src="script.js"></script>
</head>
  
<body>
  <!-- 로딩 오버레이 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">경로를 계산하는 중...</div>
    </div>
  </div>
  <!-- 로그인 화면 -->
  <div class="login-container" id="loginContainer">
    <!-- Step 1: 회사 로그인 -->
    <div class="login-box" id="companyLoginStep">
      <h1 class="login-title">로그인</h1>
      <div class="input-group">
        <label class="input-label">ID</label>
        <input type="text" class="admin-input" id="companyIdInput" placeholder="ID 입력" autocomplete="username">
        <div class="input-hint">회사 관리자에게 문의하세요</div>
      </div>
      <div class="input-group">
        <label class="input-label">비밀번호</label>
        <input type="password" class="admin-input" id="companyPasswordInput" placeholder="비밀번호 입력" autocomplete="current-password">
      </div>
      <div class="auto-login-container">
        <label class="checkbox-label">
          <input type="checkbox" class="auto-login-checkbox" id="autoLoginCheckbox">
          <span class="checkbox-text">자동 로그인</span>
        </label>
      </div>
      <button class="admin-btn" onclick="loginCompany()">로그인</button>
      <div class="divider">
        <span>또는</span>
      </div>
      <button class="secondary-btn" onclick="showCreateCompanyStep()">가입하기</button>
    </div>
    <!-- Step 2: 새 회사 만들기 -->
    <div class="login-box" id="createCompanyStep" style="display: none;">
      <h1 class="login-title">🏢 새 회사 만들기</h1>
      <button class="back-btn" onclick="backToCompanyLogin()">← 뒤로</button>
      <div class="input-group">
        <label class="input-label">회사명</label>
        <input type="text" class="admin-input" id="newCompanyNameInput" placeholder="예: (주)건설회사" autocomplete="off">
        <div class="input-hint">실제 회사 이름을 입력하세요</div>
      </div>
      <div class="input-group">
        <label class="input-label">관리자 이름</label>
        <input type="text" class="admin-input" id="newAdminNameInput" placeholder="예: 홍길동" autocomplete="off">
        <div class="input-hint">회사 관리자의 이름을 입력하세요</div>
      </div>
      <div class="input-group">
        <label class="input-label">회사 ID</label>
        <input type="text" class="admin-input" id="newCompanyIdInput" placeholder="영문+숫자 조합" autocomplete="off">
        <div class="input-hint" id="companyIdHint">영문, 숫자 조합 (4-20자)</div>
      </div>
      <div class="input-group">
        <label class="input-label">비밀번호</label>
        <input type="password" class="admin-input" id="newCompanyPasswordInput" placeholder="비밀번호 설정" autocomplete="new-password">
        <div class="input-hint">최소 4자 이상</div>
      </div>
      <div class="input-group">
        <label class="input-label">비밀번호 확인</label>
        <input type="password" class="admin-input" id="confirmPasswordInput" placeholder="비밀번호 재입력" autocomplete="new-password">
      </div>
      <button class="admin-btn" onclick="createCompany()">회사 만들기</button>
    </div>
  </div>
  <!-- 메인 앱 -->
  <div class="app-container" id="appContainer">
    <div class="app-header">
      <div class="header-row-1">
        <div class="header-left">
          <div class="user-avatar" id="userAvatar"></div>
          <div class="header-info">
            <div class="app-title">작업 관리</div>
            <div class="user-name" id="headerUserName"></div>
          </div>
        </div>
        <div class="header-right">
          <button class="menu-btn" type="button" id="mainMenuBtn">
            <span class="menu-hamburger">
              <span class="menu-line"></span>
              <span class="menu-line"></span>
              <span class="menu-line"></span>
            </span>
          </button>
        </div>
      </div>
      <div class="header-row-2">
        <div class="date-display" id="dateDisplay"></div>
        <div class="nav-buttons">
          <button class="nav-btn" onclick="goToToday()">오늘</button>
          <button class="nav-btn" onclick="changeDate(-1)">◀</button>
          <button class="nav-btn" onclick="changeDate(1)">▶</button>
        </div>
      </div>
    </div>
    <div class="main-content">
      <div class="left-panel">
        <div class="task-input-container">
          <div class="task-form">
            <div class="form-row">
              <input type="text" class="task-input" id="siteInput" placeholder="현장명">
              <button class="site-select-btn" onclick="toggleSiteSelectModal()">📋 선택</button>
            </div>
            <div class="form-row">
              <input type="text" class="task-input" id="workInput" placeholder="작업 내용 입력">
              <button class="add-btn" onclick="addWork()">+ 추가</button>
            </div>
          </div>
        </div>
        <div class="task-container" id="taskContainer"></div>
        <div class="map-section">
          <div class="map-section-header">
            <h3 class="map-section-title">
              🚗 이동 경로
              <span class="route-info" id="routeInfo" style="display: none;"></span>
            </h3>
            <div class="map-controls">
              <button class="map-btn" id="routeBtn" onclick="showRouteFromCurrentLocation()">경로 표시</button>
            </div>
          </div>
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- 메뉴 오버레이 & 드롭다운 -->
  <div class="menu-overlay" id="menuOverlay"></div>
  <div class="menu-dropdown" id="menuDropdown">
    <div class="menu-item" onclick="toggleSiteModal(); toggleMenu();">
      <span class="menu-item-icon">📍</span>
      <span class="menu-item-text">현장 추가/수정</span>
    </div>
    <div class="menu-item" onclick="toggleGuideModal(); toggleMenu();">
      <span class="menu-item-icon">📖</span>
      <span class="menu-item-text">사용 설명서</span>
    </div>
    <div id="adminMenuSection" style="display: none;">
      <div class="menu-divider"></div>
      <div class="menu-item" style="background: #fff8e1; pointer-events: none;">
        <span class="menu-item-icon">👑</span>
        <span class="menu-item-text" style="font-weight: 600; color: #F57C00;">관리 메뉴</span>
      </div>
      <div class="menu-item" onclick="toggleCompanyCodeModal(); toggleMenu();">
        <span class="menu-item-icon">🔑</span>
        <span class="menu-item-text">회사 코드 확인</span>
      </div>
      <div class="menu-item" onclick="toggleStaffManageModal(); toggleMenu();">
        <span class="menu-item-icon">👥</span>
        <span class="menu-item-text">직원 관리</span>
      </div>
      <div class="menu-item" onclick="toggleCompanyInfoModal(); toggleMenu();">
        <span class="menu-item-icon">🏢</span>
        <span class="menu-item-text">회사 정보 수정</span>
      </div>
      <div class="menu-item" onclick="toggleTransferAdminModal(); toggleMenu();">
        <span class="menu-item-icon">🔄</span>
        <span class="menu-item-text">관리자 권한 이전</span>
      </div>
    </div>
    <div class="menu-divider"></div>
    <div class="menu-item menu-item-danger" onclick="deleteCompany()">
      <span class="menu-item-icon">⚠️</span>
      <span class="menu-item-text">회사 탈퇴</span>
    </div>
    <div class="menu-item menu-item-danger" onclick="logout()">
      <span class="menu-item-icon">🚪</span>
      <span class="menu-item-text">로그아웃</span>
    </div>
  </div>
  <!-- 작업 타임라인 모달 -->
  <div class="modal-overlay" id="timelineModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="timelineTitle"></h3>
        <button class="close-btn" onclick="closeTimelineModal()">×</button>
      </div>
      <div id="timelineContent"></div>
    </div>
  </div>
  <!-- 현장 관리 모달 -->
  <div class="modal-overlay" id="siteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="siteModalTitle">현장 추가</h3>
        <button class="close-btn" onclick="toggleSiteModal()">×</button>
      </div>
      <div class="add-site-form">
        <input type="text" class="task-input" id="newSiteName" placeholder="현장명 입력">
        <input type="text" class="task-input" id="newSiteAddress" placeholder="주소 입력">
        <button class="add-btn" id="saveSiteBtn" onclick="saveSite()">저장</button>
        <button class="secondary-btn" id="cancelEditBtn" onclick="cancelEditSite()" style="display: none;">취소</button>
      </div>
      <div class="site-list-section">
        <h4 class="site-list-title">저장된 현장 목록</h4>
        <ul class="site-list" id="siteList"></ul>
      </div>
    </div>
  </div>
  <!-- 완료 기한 선택 모달 -->
  <div class="deadline-modal" id="deadlineModal">
    <div class="deadline-modal-content">
      <div class="deadline-modal-header">완료 기한 선택</div>
      <div class="deadline-options">
        <div class="deadline-option" onclick="selectDeadline('today')">
          <span class="deadline-option-label">오늘</span>
          <span class="deadline-option-date" id="todayDate"></span>
        </div>
        <div class="deadline-option" onclick="selectDeadline('tomorrow')">
          <span class="deadline-option-label">내일</span>
          <span class="deadline-option-date" id="tomorrowDate"></span>
        </div>
        <div class="deadline-option" onclick="selectDeadline('thisWeek')">
          <span class="deadline-option-label">이번주 중 (금요일)</span>
          <span class="deadline-option-date" id="thisWeekDate"></span>
        </div>
        <div class="deadline-custom">
          <input type="date" class="deadline-date-input" id="customDeadlineInput">
          <button class="deadline-confirm-btn" onclick="selectDeadline('custom')">확인</button>
        </div>
      </div>
    </div>
  </div>
  <!-- 현장 선택 모달 -->
  <div class="modal-overlay" id="siteSelectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">현장 선택</h3>
        <button class="close-btn" onclick="toggleSiteSelectModal()">×</button>
      </div>
      <ul class="site-list" id="siteSelectList"></ul>
    </div>
  </div>
  <!-- 회사 코드 확인 모달 -->
  <div class="modal-overlay" id="companyCodeModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🔑 회사 코드</h3>
        <button class="close-btn" onclick="toggleCompanyCodeModal()">×</button>
      </div>
      <div style="text-align: center; padding: 30px 20px;">
        <p style="font-size: 14px; color: #666; margin-bottom: 20px;">
          직원 초대 시 이 코드를 공유하세요
        </p>
        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f5f7fa 100%); border: 3px dashed #2a459c; border-radius: 12px; padding: 30px; margin-bottom: 20px;">
          <div style="font-size: 36px; font-weight: 700; color: #2a459c; letter-spacing: 4px; font-family: 'Courier New', monospace;" id="displayCompanyCode">
            ------
          </div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button class="admin-btn" onclick="copyCompanyCode()" style="flex: 1; max-width: 200px;">
            📋 복사하기
          </button>
          <button class="admin-btn" onclick="regenerateCompanyCode()" style="flex: 1; max-width: 200px; background: #ff9800;">
            🔄 코드 재발급
          </button>
        </div>
        <p style="font-size: 12px; color: #999; margin-top: 20px;">
          💡 코드를 재발급하면 기존 코드는 사용할 수 없습니다
        </p>
      </div>
    </div>
  </div>
  <!-- 직원 관리 모달 -->
  <div class="modal-overlay" id="staffManageModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">👥 직원 관리</h3>
        <button class="close-btn" onclick="toggleStaffManageModal()">×</button>
      </div>
      <div style="padding: 10px 0;">
        <div style="margin-bottom: 20px;">
          <h4 style="font-size: 14px; color: #666; margin-bottom: 12px; font-weight: 600;">
            현재 직원 목록 (<span id="staffCount">0</span>명)
          </h4>
          <ul class="site-list" id="staffList"></ul>
        </div>
      </div>
    </div>
  </div>
  <!-- 회사 정보 수정 모달 -->
  <div class="modal-overlay" id="companyInfoModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🏢 회사 정보 수정</h3>
        <button class="close-btn" onclick="toggleCompanyInfoModal()">×</button>
      </div>
      <div style="padding: 10px 0;">
        <div class="input-group">
          <label class="input-label">회사명</label>
          <input type="text" class="admin-input" id="editCompanyName" placeholder="회사명">
        </div>
        <div class="input-group">
          <label class="input-label">현재 비밀번호</label>
          <input type="password" class="admin-input" id="currentPasswordForEdit" placeholder="현재 비밀번호">
          <div class="input-hint">변경하려면 현재 비밀번호를 입력하세요</div>
        </div>
        <div class="input-group">
          <label class="input-label">새 비밀번호 (선택)</label>
          <input type="password" class="admin-input" id="newPasswordForEdit" placeholder="변경할 비밀번호">
          <div class="input-hint">변경하지 않으려면 비워두세요</div>
        </div>
        <div class="input-group">
          <label class="input-label">새 비밀번호 확인</label>
          <input type="password" class="admin-input" id="confirmNewPassword" placeholder="비밀번호 재입력">
        </div>
        <button class="admin-btn" onclick="saveCompanyInfo()">💾 저장</button>
      </div>
    </div>
  </div>
  <!-- 관리자 권한 이전 모달 -->
  <div class="modal-overlay" id="transferAdminModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🔄 관리자 권한 이전</h3>
        <button class="close-btn" onclick="toggleTransferAdminModal()">×</button>
      </div>
      <div style="padding: 10px 0;">
        <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
          <p style="font-size: 13px; color: #e65100; line-height: 1.6;">
            ⚠️ <strong>주의:</strong> 관리자 권한을 이전하면 본인은 일반 직원이 됩니다. 이 작업은 되돌릴 수 없습니다.
          </p>
        </div>
        <div class="input-group">
          <label class="input-label">새 관리자 선택</label>
          <select class="admin-input" id="newAdminSelect">
            <option value="">선택하세요</option>
          </select>
        </div>
        <div class="input-group">
          <label class="input-label">비밀번호 확인</label>
          <input type="password" class="admin-input" id="passwordForTransfer" placeholder="현재 비밀번호">
          <div class="input-hint">권한 이전을 확인하기 위해 비밀번호를 입력하세요</div>
        </div>
        <button class="admin-btn" onclick="transferAdmin()" style="background: #ff9800;">
          🔄 권한 이전
        </button>
      </div>
    </div>
  </div>
  <!-- 사용 설명서 모달 -->
  <div class="modal-overlay" id="guideModal">
    <div class="modal-content guide-modal-content">
      <div class="modal-header">
        <h3 class="modal-title">📖 사용 설명서</h3>
        <button class="close-btn" onclick="toggleGuideModal()">×</button>
      </div>
      <div class="guide-content">
        <!-- 1. 시작하기 -->
        <div class="guide-section">
          <h3 class="guide-section-title">🚀 1. 시작하기</h3>
          <div class="guide-step">
            <div class="guide-step-number">1</div>
            <div class="guide-step-content">
              <h4>사용자 선택</h4>
              <p>로그인 화면에서 본인의 이름을 선택하세요. 새 사용자는 하단에서 추가할 수 있습니다.</p>
            </div>
          </div>
        </div>
        <!-- 2. 현장 관리 -->
        <div class="guide-section">
          <h3 class="guide-section-title">🏗️ 2. 현장 관리</h3>
          <div class="guide-step">
            <div class="guide-step-number">2</div>
            <div class="guide-step-content">
              <h4>현장 추가하기</h4>
              <p>① 우측 상단 메뉴(☰) → "현장 추가" 클릭<br>
                 ② 현장명과 주소 입력<br>
                 ③ 저장 버튼 클릭</p>
              <div class="guide-tip">💡 주소는 경로 표시 기능에 사용되므로 정확히 입력하세요.</div>
            </div>
          </div>
        </div>
        <!-- 3. 작업 추가 -->
        <div class="guide-section">
          <h3 class="guide-section-title">✍️ 3. 작업 추가</h3>
          <div class="guide-step">
            <div class="guide-step-number">3</div>
            <div class="guide-step-content">
              <h4>일반 작업 추가</h4>
              <p>① 현장명 입력 (또는 "선택" 버튼으로 등록된 현장 선택)<br>
                 ② 작업 내용 입력 (예: 배근, 거푸집, 콘크리트 타설 등)<br>
                 ③ "추가" 버튼 클릭</p>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-number">4</div>
            <div class="guide-step-content">
              <h4>시험 작업 추가 (자동 일정 생성)</h4>
              <p>작업 내용에 "시험"을 입력하면 자동으로 관련 일정이 생성됩니다:</p>
              <ul class="guide-list">
                <li>시험 당일</li>
                <li>캡핑 (영업일 +1일)</li>
                <li>탈형 (영업일 +2일)</li>
                <li>7일 강도 시험 (+7일)</li>
                <li>28일 강도 시험 (+28일)</li>
              </ul>
              <div class="guide-tip">💡 시험 관련 작업은 작업등록일자를 클릭하면 전체 타임라인을 볼 수 있습니다.</div>
            </div>
          </div>
        </div>
        <!-- 4. 작업 관리 -->
        <div class="guide-section">
          <h3 class="guide-section-title">📋 4. 작업 관리</h3>
          <div class="guide-step">
            <div class="guide-step-number">5</div>
            <div class="guide-step-content">
              <h4>작업 순서 변경</h4>
              <p><strong>PC:</strong> 작업 카드를 드래그하여 위아래로 이동<br>
                 <strong>모바일:</strong> 작업 카드를 길게 누르고 상하로 드래그</p>
              <div class="guide-tip">💡 "내 작업 진행 중" 섹션에서만 순서 변경 가능</div>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-number">6</div>
            <div class="guide-step-content">
              <h4>작업 완료 체크</h4>
              <p>작업 카드 왼쪽의 체크박스를 클릭하면 완료 처리됩니다.<br>
                 완료된 작업의 체크박스를 다시 클릭하면 진행중으로 되돌아갑니다.</p>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-number">7</div>
            <div class="guide-step-content">
              <h4>작업 삭제</h4>
              <p><strong>PC:</strong> 작업 카드 우측의 🗑️ 버튼 클릭<br>
                 <strong>모바일:</strong> 작업 카드를 왼쪽으로 슬라이드하면 삭제 버튼 표시</p>
              <div class="guide-warning">⚠️ 시험 작업 삭제 시 관련된 모든 작업(캡핑, 탈형 등)이 함께 삭제됩니다.</div>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-number">8</div>
            <div class="guide-step-content">
              <h4>담당자 지정</h4>
              <p>작업 카드의 담당자 선택 드롭다운에서 담당자를 변경할 수 있습니다.</p>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-number">9</div>
            <div class="guide-step-content">
              <h4>완료 기한 설정</h4>
              <p>작업 카드의 "완료 기한" 날짜를 클릭하면 기한을 변경할 수 있습니다:<br>
                 • 오늘<br>
                 • 내일<br>
                 • 이번주 중 (금요일)<br>
                 • 직접 날짜 선택</p>
              <div class="guide-warning">⚠️ 기한이 지난 작업은 빨간색으로 표시되며 "기한초과" 뱃지가 표시됩니다.</div>
            </div>
          </div>
        </div>
        <!-- 5. 날짜 네비게이션 -->
        <div class="guide-section">
          <h3 class="guide-section-title">📅 5. 날짜 네비게이션</h3>
          <div class="guide-step">
            <div class="guide-step-number">10</div>
            <div class="guide-step-content">
              <h4>날짜 이동</h4>
              <p>헤더의 날짜 표시 옆 버튼으로 날짜를 이동할 수 있습니다:<br>
                 • <strong>오늘:</strong> 오늘 날짜로 이동<br>
                 • <strong>◀:</strong> 하루 전으로<br>
                 • <strong>▶:</strong> 하루 후로</p>
              <div class="guide-tip">💡 선택한 날짜 이전의 미완료 작업도 함께 표시됩니다.</div>
            </div>
          </div>
        </div>
        <!-- 6. 경로 표시 -->
        <div class="guide-section">
          <h3 class="guide-section-title">🗺️ 6. 이동 경로 표시</h3>
          <div class="guide-step">
            <div class="guide-step-number">11</div>
            <div class="guide-step-content">
              <h4>경로 확인하기</h4>
              <p>① 지도 섹션의 "경로 표시" 버튼 클릭<br>
                 ② 위치 권한 허용<br>
                 ③ 현재 위치에서 출발하여 작업 순서대로 현장을 방문하는 최적 경로가 표시됩니다.</p>
              <div class="guide-tip">💡 경로는 작업 순서에 따라 자동으로 계산되며, 총 거리와 소요 시간이 표시됩니다.</div>
            </div>
          </div>
        </div>
        <!-- 7. 팁과 요령 -->
        <div class="guide-section">
          <h3 class="guide-section-title">💡 7. 유용한 팁</h3>
          <div class="guide-tips-list">
            <div class="guide-tip-item">
              <span class="tip-emoji">✅</span>
              <span>아침에 출근하면 작업 순서를 먼저 정리하세요. 이동 경로가 자동으로 최적화됩니다.</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji">📍</span>
              <span>자주 방문하는 현장은 미리 등록해두면 빠르게 선택할 수 있습니다.</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji">📋</span>
              <span>섹션 헤더를 클릭하면 접거나 펼칠 수 있어 화면을 효율적으로 사용할 수 있습니다.</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji">🔔</span>
              <span>시험 작업은 자동으로 일정이 생성되므로 일일이 입력할 필요가 없습니다.</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji">👥</span>
              <span>팀 작업도 한눈에 볼 수 있어 업무 분담과 협업이 쉽습니다.</span>
            </div>
          </div>
        </div>
        <!-- 8. 문의하기 -->
        <div class="guide-section">
          <h3 class="guide-section-title">📞 8. 문의하기</h3>
          <div class="guide-contact">
            <p>사용 중 문의사항이나 개선 제안이 있으시면 언제든 연락주세요.</p>
            <div class="contact-info">
              <div class="contact-item">
                <span class="contact-icon">📧</span>
                <span>이메일: support@example.com</span>
              </div>
              <div class="contact-item">
                <span class="contact-icon">💬</span>
                <span>카카오톡: @작업관리앱</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Kakao Map API -->
  <!-- Firebase SDK -->
</body>
</html>
