<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>작업 관리</title>
  <link rel="stylesheet" href="styles.css?v=Ver.0.9.7">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
  <!-- Toast 알림 컨테이너 -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- 로딩 오버레이 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">경로를 계산하는 중...</div>
    </div>
  </div>

  <!-- 로그인 화면 -->
  <div class="login-container" id="loginContainer">
    <!-- Step 1: 회사 로그인 -->
    <div class="login-box" id="companyLoginStep">
      <h1 class="login-title">로그인</h1>
      
      <div class="input-group">
        <label class="input-label">ID</label>
        <input type="text" class="admin-input" id="companyIdInput" placeholder="ID 입력" autocomplete="username">
        <div class="input-hint">회사 관리자에게 문의하세요</div>
      </div>
      
      <div class="input-group">
        <label class="input-label">비밀번호</label>
        <input type="password" class="admin-input" id="companyPasswordInput" placeholder="비밀번호 입력" autocomplete="current-password">
      </div>

      <button class="admin-btn" onclick="loginCompany()">로그인</button>
      
      <div class="divider">
        <span>또는</span>
      </div>
      
      <button class="secondary-btn" onclick="showCreateCompanyStep()">가입하기</button>
    </div>

    <!-- Step 2: 계정 만들기 -->
    <div class="login-box" id="createCompanyStep" style="display: none;">
      <h1 class="login-title">🏢 계정 만들기</h1>
      <button class="back-btn" onclick="backToCompanyLogin()">← 뒤로</button>

      <div class="input-group">
        <label class="input-label">이름</label>
        <input type="text" class="admin-input" id="newAdminNameInput" placeholder="예: 홍길동" autocomplete="off">
        <div class="input-hint">본인의 이름을 입력하세요</div>
      </div>
      
      <div class="input-group">
        <label class="input-label">ID</label>
        <input type="text" class="admin-input" id="newCompanyIdInput" placeholder="영문+숫자 조합" autocomplete="off">
        <div class="input-hint" id="companyIdHint">영문, 숫자 조합 (4-20자)</div>
      </div>
      
      <div class="input-group">
        <label class="input-label">비밀번호</label>
        <input type="password" class="admin-input" id="newCompanyPasswordInput" placeholder="비밀번호 설정" autocomplete="new-password">
        <div class="input-hint">최소 4자 이상</div>
      </div>
      
      <div class="input-group">
        <label class="input-label">비밀번호 확인</label>
        <input type="password" class="admin-input" id="confirmPasswordInput" placeholder="비밀번호 재입력" autocomplete="new-password">
      </div>
      
      <button class="admin-btn" onclick="createCompany()">가입하기</button>
    </div>
  </div>

  <!-- 메인 앱 -->
  <div class="app-container" id="appContainer">
    <div class="app-header">
      <div class="header-row-1">
        <div class="header-left">
          <div class="user-avatar" id="userAvatar"></div>
          <div class="header-info">
            <div class="app-title">작업 관리</div>
            <div class="user-name" id="headerUserName"></div>
          </div>
        </div>
        <div class="header-right">
          <button class="menu-btn" type="button" id="mainMenuBtn" onclick="toggleMenu()">
            <span class="menu-hamburger">
              <span class="menu-line"></span>
              <span class="menu-line"></span>
              <span class="menu-line"></span>
            </span>
          </button>
        </div>
      </div>

      <div class="header-row-2">
        <div class="date-display" id="dateDisplay"></div>
        <div class="nav-buttons">
          <button class="nav-btn" onclick="goToToday()">오늘</button>
          <button class="nav-btn" onclick="changeDate(-1)">◀</button>
          <button class="nav-btn" onclick="changeDate(1)">▶</button>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="left-panel">
        <div class="task-input-container">
          <div class="task-form">
            <div class="form-row">
              <input type="text" class="task-input" id="siteInput" placeholder="현장명">
              <button class="site-select-btn" onclick="toggleSiteSelectModal()"><i data-lucide="clipboard" style="width: 16px; height: 16px;"></i> 선택</button>
            </div>
            <div class="form-row">
              <input type="text" class="task-input" id="workInput" placeholder="작업 내용 입력">
              <button class="add-btn" onclick="addWork()">+ 추가</button>
            </div>
          </div>
        </div>

        <div class="task-container" id="taskContainer"></div>

        <div class="map-section">
          <div class="map-section-header">
            <h3 class="map-section-title">
              <i data-lucide="car" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 이동 경로
              <span class="route-info" id="routeInfo" style="display: none;"></span>
            </h3>
            <div class="map-controls">
              <button class="map-btn" id="naviBtn" onclick="launchNavigation()"><i data-lucide="compass" style="width: 16px; height: 16px;"></i> 네비 실행</button>
            </div>
          </div>
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 메뉴 오버레이 & 드롭다운 -->
  <div class="menu-overlay" id="menuOverlay"></div>
  
  <div class="menu-dropdown" id="menuDropdown">
    <div class="menu-item" onclick="toggleSiteModal(); toggleMenu();">
      <span class="menu-item-icon"><i data-lucide="map-pin"></i></span>
      <span class="menu-item-text">현장 추가/수정</span>
    </div>
    <div class="menu-item" onclick="toggleGuideModal(); toggleMenu();">
      <span class="menu-item-icon"><i data-lucide="book-open"></i></span>
      <span class="menu-item-text">사용 설명서</span>
    </div>
    
    <div class="menu-divider"></div>
    <div class="menu-item" onclick="toggleTeamManagementModal(); toggleMenu();">
      <span class="menu-item-icon"><i data-lucide="users"></i></span>
      <span class="menu-item-text">팀 관리 <span id="invitationBadge" style="display: none; background: #f44336; color: white; border-radius: 10px; padding: 2px 6px; font-size: 11px; margin-left: 5px;"></span></span>
    </div>

    <div class="menu-divider"></div>
    <div class="menu-item menu-item-danger" onclick="logout()">
      <span class="menu-item-icon"><i data-lucide="log-out"></i></span>
      <span class="menu-item-text">로그아웃</span>
    </div>
  </div>

  <!-- 작업 타임라인 모달 -->
  <div class="modal-overlay" id="timelineModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="timelineTitle"></h3>
        <button class="close-btn" onclick="closeTimelineModal()">×</button>
      </div>
      <div id="timelineContent"></div>
    </div>
  </div>

  <!-- 현장 관리 모달 -->
  <div class="modal-overlay" id="siteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="siteModalTitle">현장 추가</h3>
        <button class="close-btn" onclick="toggleSiteModal()">×</button>
      </div>
  
      <div class="add-site-form">
        <input type="text" class="task-input" id="newSiteName" placeholder="현장명 입력">
        <input type="text" class="task-input" id="newSiteAddress" placeholder="주소 입력">
        <textarea class="task-input" id="newSiteNotes" placeholder="특이사항 입력 (예: 주차 공간 협소, 안전모 필수 등)" rows="3" style="resize: vertical; min-height: 60px;"></textarea>
        <button class="add-btn" id="saveSiteBtn" onclick="saveSite()">저장</button>
        <button class="secondary-btn" id="cancelEditBtn" onclick="cancelEditSite()" style="display: none;">취소</button>
      </div>
  
      <div class="site-list-section">
        <h4 class="site-list-title">저장된 현장 목록</h4>
        <ul class="site-list" id="siteList"></ul>
      </div>
    </div>
  </div>

  <!-- 완료 기한 선택 모달 -->
  <div class="deadline-modal" id="deadlineModal">
    <div class="deadline-modal-content">
      <div class="deadline-modal-header">완료 기한 선택</div>
      <div class="deadline-options">
        <div class="deadline-option" onclick="selectDeadline('today')">
          <span class="deadline-option-label">오늘</span>
          <span class="deadline-option-date" id="todayDate"></span>
        </div>
        <div class="deadline-option" onclick="selectDeadline('tomorrow')">
          <span class="deadline-option-label">내일</span>
          <span class="deadline-option-date" id="tomorrowDate"></span>
        </div>
        <div class="deadline-option" onclick="selectDeadline('thisWeek')">
          <span class="deadline-option-label">이번주 중 (금요일)</span>
          <span class="deadline-option-date" id="thisWeekDate"></span>
        </div>
        <div class="deadline-custom">
          <input type="date" class="deadline-date-input" id="customDeadlineInput">
          <button class="deadline-confirm-btn" onclick="selectDeadline('custom')">확인</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 현장 선택 모달 -->
  <div class="modal-overlay" id="siteSelectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">현장 선택</h3>
        <button class="close-btn" onclick="toggleSiteSelectModal()">×</button>
      </div>
      <ul class="site-list" id="siteSelectList"></ul>
    </div>
  </div>

  <!-- 작업 메모 모달 -->
  <div class="modal-overlay" id="workDetailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">작업 메모</h3>
        <button class="close-btn" onclick="toggleWorkDetailModal()">×</button>
      </div>

      <!-- 현장 특이사항 표시 -->
      <div class="site-notes-section" id="siteNotesSection" style="display: none;">
        <div class="site-notes-header">📝 현장 특이사항</div>
        <div class="site-notes-content" id="workDetailSiteNotes"></div>
      </div>

      <!-- 작업 메모 -->
      <div class="work-detail-memo">
        <label for="workMemo">작업 메모</label>
        <textarea id="workMemo" class="task-input" placeholder="이 작업에 대한 메모를 입력하세요&#10;(예: 작업 진행 상황, 특이사항 등)" rows="6" style="resize: vertical; min-height: 120px;"></textarea>
        <button class="add-btn" onclick="saveWorkMemo()">메모 저장</button>
      </div>
    </div>
  </div>

  <!-- 팀코드 확인 모달 -->
  <div class="modal-overlay" id="companyCodeModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🔑 팀코드</h3>
        <button class="close-btn" onclick="toggleCompanyCodeModal()">×</button>
      </div>
      
      <div style="text-align: center; padding: 30px 20px;">
        <p style="font-size: 14px; color: #666; margin-bottom: 20px;">
          직원 초대 시 이 코드를 공유하세요
        </p>
        
        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f5f7fa 100%); border: 3px dashed #2a459c; border-radius: 12px; padding: 30px; margin-bottom: 20px;">
          <div style="font-size: 36px; font-weight: 700; color: #2a459c; letter-spacing: 4px; font-family: 'Courier New', monospace;" id="displayCompanyCode">
            ------
          </div>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button class="admin-btn" id="copyBtn" onclick="copyCompanyCode()" style="flex: 1; max-width: 200px;">
            📋 복사하기
          </button>
          <button class="admin-btn" onclick="regenerateCompanyCode()" style="flex: 1; max-width: 200px; background: #ff9800;">
            🔄 코드 재발급
          </button>
        </div>
        
        <p style="font-size: 12px; color: #999; margin-top: 20px;">
          💡 코드를 재발급하면 기존 코드는 사용할 수 없습니다
        </p>
      </div>
    </div>
  </div>

  <!-- 팀 선택 모달 (팀이 없을 때) -->
  <div class="modal-overlay" id="teamSelectionModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">👥 팀 관리</h3>
        <button class="close-btn" onclick="toggleTeamSelectionModal()">×</button>
      </div>

      <div style="padding: 20px;">
        <!-- 받은 초대 섹션 -->
        <div id="teamSelectionInvitations" style="margin-bottom: 20px;">
          <!-- 초대 목록이 여기에 동적으로 추가됩니다 -->
        </div>

        <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 14px;">
          현재 소속된 팀이 없습니다.<br>새 팀을 만들거나 기존 팀에 참여하세요.
        </p>

        <div style="display: flex; flex-direction: column; gap: 15px;">
          <button class="admin-btn" onclick="toggleTeamSelectionModal(); toggleCreateTeamModal();" style="width: 100%; padding: 15px; font-size: 15px;">
            ➕ 새 팀 만들기
          </button>
          <button class="admin-btn" onclick="toggleTeamSelectionModal(); toggleJoinTeamModal();" style="width: 100%; padding: 15px; font-size: 15px; background: #1976d2;">
            🔗 기존 팀 참여하기
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 팀 만들기 모달 -->
  <div class="modal-overlay" id="createTeamModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">➕ 팀 만들기</h3>
        <button class="close-btn" onclick="toggleCreateTeamModal()">×</button>
      </div>

      <div style="padding: 20px;">
        <div class="input-group">
          <label class="input-label">팀명</label>
          <input type="text" class="admin-input" id="newTeamNameInput" placeholder="예: 프로젝트 A팀" autocomplete="off">
          <div class="input-hint">팀원들과 공유할 팀 이름을 입력하세요</div>
        </div>

        <button class="admin-btn" onclick="createTeam()" style="width: 100%; margin-top: 20px;">
          팀 만들기
        </button>
      </div>
    </div>
  </div>

  <!-- 팀 참여하기 모달 -->
  <div class="modal-overlay" id="joinTeamModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🔗 팀 참여하기</h3>
        <button class="close-btn" onclick="toggleJoinTeamModal()">×</button>
      </div>

      <div style="padding: 20px;">
        <p style="font-size: 14px; color: #666; margin-bottom: 20px; text-align: center;">
          팀 관리자에게 받은 팀코드를 입력하세요
        </p>

        <div class="input-group">
          <label class="input-label">팀코드</label>
          <input type="text" class="admin-input" id="joinTeamCodeInput" placeholder="예: ABC123" autocomplete="off" style="text-transform: uppercase; letter-spacing: 2px; text-align: center; font-family: 'Courier New', monospace; font-size: 18px;">
          <div class="input-hint">6자리 팀코드를 입력하세요</div>
        </div>

        <button class="admin-btn" onclick="joinTeam()" style="width: 100%; margin-top: 20px;">
          참여하기
        </button>
      </div>
    </div>
  </div>

  <!-- 팀원 초대 모달 -->
  <div class="modal-overlay" id="inviteMemberModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">👥 팀원 초대</h3>
        <button class="close-btn" onclick="toggleInviteMemberModal()">×</button>
      </div>

      <div style="padding: 20px;">
        <div style="margin-bottom: 30px;">
          <h4 style="font-size: 14px; color: #666; margin-bottom: 12px; font-weight: 600;">
            ① 팀코드 공유
          </h4>
          <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f5f7fa 100%); border: 2px dashed #1976d2; border-radius: 12px; padding: 20px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #1976d2; letter-spacing: 3px; font-family: 'Courier New', monospace; margin-bottom: 15px;" id="inviteTeamCode">
              ------
            </div>
            <button class="admin-btn" id="copyInviteCodeBtn" onclick="copyTeamCodeForInvite()" style="max-width: 200px;">
              📋 코드 복사하기
            </button>
          </div>
          <p style="font-size: 12px; color: #999; margin-top: 10px; text-align: center;">
            이 코드를 팀원에게 공유하세요
          </p>
        </div>

        <div class="divider" style="margin: 30px 0;">
          <span>또는</span>
        </div>

        <div>
          <h4 style="font-size: 14px; color: #666; margin-bottom: 12px; font-weight: 600;">
            ② ID로 직접 초대
          </h4>
          <div class="input-group">
            <label class="input-label">사용자 ID</label>
            <input type="text" class="admin-input" id="inviteUserIdInput" placeholder="초대할 사용자의 ID 입력" autocomplete="off" onkeypress="if(event.key==='Enter') inviteByUserId()">
            <div class="input-hint">초대하려는 사용자의 로그인 ID를 입력하세요</div>
          </div>

          <button class="admin-btn" onclick="inviteByUserId()" style="width: 100%; margin-top: 15px;">
            초대 보내기
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 팀 설정 모달 -->
  <div class="modal-overlay" id="teamSettingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">⚙️ 팀 설정</h3>
        <button class="close-btn" onclick="toggleTeamSettingsModal()">×</button>
      </div>

      <div style="padding: 10px;">
        <!-- 팀명 수정 -->
        <div class="input-group" style="margin-bottom: 10px;">
          <label class="input-label" style="margin-bottom: 4px;">팀명</label>
          <div style="display: flex; gap: 6px; align-items: center;">
            <input type="text" class="admin-input" id="editTeamNameInput" placeholder="팀 이름" autocomplete="off" style="padding: 10px 12px; margin-bottom: 0; flex: 1;">
            <button class="admin-btn" onclick="saveTeamSettings()" style="padding: 8px 12px; font-size: 12px; white-space: nowrap; width: auto; flex: 0 0 auto;">
              저장
            </button>
          </div>
        </div>

        <!-- 팀코드 표시 -->
        <div style="margin-bottom: 10px;">
          <h4 style="font-size: 13px; color: #666; margin-bottom: 6px; font-weight: 600;">
            팀코드
          </h4>
          <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f5f7fa 100%); border: 2px dashed #1976d2; border-radius: 8px; padding: 8px; text-align: center;">
            <div style="font-size: 18px; font-weight: 700; color: #1976d2; letter-spacing: 2px; font-family: 'Courier New', monospace; margin-bottom: 8px;" id="settingsTeamCode">
              ------
            </div>
            <div style="display: flex; gap: 6px; justify-content: center;">
              <button class="admin-btn" id="copySettingsCodeBtn" onclick="copyTeamCodeFromSettings()" style="flex: 1; max-width: 140px; padding: 8px; font-size: 13px;">
                📋 복사
              </button>
              <button class="admin-btn" onclick="changeTeamCode()" style="flex: 1; max-width: 140px; padding: 8px; font-size: 13px; background: #ff9800;">
                🔄 변경
              </button>
            </div>
          </div>
        </div>

        <!-- 팀원 초대 -->
        <div style="margin-bottom: 10px;">
          <h4 style="font-size: 13px; color: #666; margin-bottom: 6px; font-weight: 600;">
            ID로 팀원 초대
          </h4>
          <input type="text" class="admin-input" id="settingsInviteUserIdInput" placeholder="초대할 사용자 ID" autocomplete="off" style="padding: 8px 12px; margin-bottom: 6px;">
          <button class="admin-btn" onclick="inviteByUserIdFromSettings()" style="width: 100%; padding: 8px; font-size: 13px;">
            초대 보내기
          </button>
        </div>

        <!-- 팀원 목록 -->
        <div style="margin-bottom: 10px;">
          <h4 style="font-size: 13px; color: #666; margin-bottom: 6px; font-weight: 600;">
            팀원 목록 (<span id="teamMemberCount">0</span>명)
          </h4>
          <ul class="site-list" id="teamMemberList"></ul>
        </div>

        <!-- 버튼들 -->
        <button class="admin-btn" onclick="leaveTeam()" style="width: 100%; padding: 10px; font-size: 13px; background: #f44336;">
          팀 나가기
        </button>
      </div>
    </div>
  </div>

  <!-- 팀 초대 목록 모달 -->
  <div class="modal-overlay" id="invitationsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">📬 팀 초대</h3>
        <button class="close-btn" onclick="toggleInvitationsModal()">×</button>
      </div>

      <div style="padding: 20px;">
        <div id="invitationsList">
          <p style="text-align: center; color: #999; padding: 40px 20px;">
            받은 초대가 없습니다
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- 직원 관리 모달 -->
  <div class="modal-overlay" id="staffManageModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">👥 직원 관리</h3>
        <button class="close-btn" onclick="toggleStaffManageModal()">×</button>
      </div>
      
      <div style="padding: 10px 0;">
        <div style="margin-bottom: 20px;">
          <h4 style="font-size: 14px; color: #666; margin-bottom: 12px; font-weight: 600;">
            현재 직원 목록 (<span id="staffCount">0</span>명)
          </h4>
          <ul class="site-list" id="staffList"></ul>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 회사 정보 수정 모달 -->
  <div class="modal-overlay" id="companyInfoModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🏢 회사 정보 수정</h3>
        <button class="close-btn" onclick="toggleCompanyInfoModal()">×</button>
      </div>
      
      <div style="padding: 10px 0;">
        <div class="input-group">
          <label class="input-label">회사명</label>
          <input type="text" class="admin-input" id="editCompanyName" placeholder="회사명">
        </div>
        
        <div class="input-group">
          <label class="input-label">현재 비밀번호</label>
          <input type="password" class="admin-input" id="currentPasswordForEdit" placeholder="현재 비밀번호">
          <div class="input-hint">변경하려면 현재 비밀번호를 입력하세요</div>
        </div>
        
        <div class="input-group">
          <label class="input-label">새 비밀번호 (선택)</label>
          <input type="password" class="admin-input" id="newPasswordForEdit" placeholder="변경할 비밀번호">
          <div class="input-hint">변경하지 않으려면 비워두세요</div>
        </div>
        
        <div class="input-group">
          <label class="input-label">새 비밀번호 확인</label>
          <input type="password" class="admin-input" id="confirmNewPassword" placeholder="비밀번호 재입력">
        </div>
        
        <button class="admin-btn" onclick="saveCompanyInfo()">💾 저장</button>
      </div>
    </div>
  </div>
  
  <!-- 관리자 권한 이전 모달 -->
  <div class="modal-overlay" id="transferAdminModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🔄 관리자 권한 이전</h3>
        <button class="close-btn" onclick="toggleTransferAdminModal()">×</button>
      </div>
      
      <div style="padding: 10px 0;">
        <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
          <p style="font-size: 13px; color: #e65100; line-height: 1.6;">
            ⚠️ <strong>주의:</strong> 관리자 권한을 이전하면 본인은 일반 직원이 됩니다. 이 작업은 되돌릴 수 없습니다.
          </p>
        </div>
        
        <div class="input-group">
          <label class="input-label">새 관리자 선택</label>
          <select class="admin-input" id="newAdminSelect">
            <option value="">선택하세요</option>
          </select>
        </div>
        
        <div class="input-group">
          <label class="input-label">비밀번호 확인</label>
          <input type="password" class="admin-input" id="passwordForTransfer" placeholder="현재 비밀번호">
          <div class="input-hint">권한 이전을 확인하기 위해 비밀번호를 입력하세요</div>
        </div>
        
        <button class="admin-btn" onclick="transferAdmin()" style="background: #ff9800;">
          🔄 권한 이전
        </button>
      </div>
    </div>
  </div>
  
  <!-- 사용 설명서 모달 -->
  <div class="modal-overlay" id="guideModal">
    <div class="modal-content guide-modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i data-lucide="book-open" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 사용 설명서</h3>
        <button class="close-btn" onclick="toggleGuideModal()">×</button>
      </div>
      
      <div class="guide-content">
        <!-- 1. 현장 관리 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="building-2" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 1. 현장 관리</h3>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>현장 추가하기</h4>
              <p>메뉴(☰) → "현장 추가/수정" → 현장명과 주소 입력 → 저장</p>
              <div class="guide-tip"><i data-lucide="lightbulb" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 주소를 입력하면 자동 경로 표시에 사용됩니다.</div>
            </div>
          </div>
        </div>

        <!-- 2. 작업 추가 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="pencil" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 2. 작업 추가</h3>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>일반 작업</h4>
              <p>현장명 입력 (또는 "선택" 버튼) → 작업 내용 입력 → "추가"</p>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>시험 작업 (자동 일정 생성)</h4>
              <p>작업 내용에 "시험" 입력 시 자동으로 일정이 생성됩니다:</p>
              <div class="guide-tip">
                시험 당일 → 캡핑(+1일) → 탈형(+2일) → 7일 강도(+7일) → 28일 강도(+28일)
              </div>
            </div>
          </div>
        </div>

        <!-- 3. 작업 관리 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="clipboard-list" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 3. 작업 관리</h3>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>순서 변경</h4>
              <p>• PC: 드래그하여 이동 | 모바일: 길게 눌러 드래그</p>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>완료 체크</h4>
              <p>체크박스 클릭 → 완료 처리 | 다시 클릭 → 진행중 복원</p>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>삭제</h4>
              <p>• PC: <i data-lucide="trash-2" style="width: 14px; height: 14px; vertical-align: text-bottom;"></i> 버튼 | 모바일: 왼쪽 슬라이드</p>
              <div class="guide-warning"><i data-lucide="alert-triangle" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 시험 작업 삭제 시 관련 작업 모두 삭제</div>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>담당자 & 기한</h4>
              <p>• 담당자: 드롭다운에서 선택<br>
                 • 기한: 날짜 클릭 → 오늘/내일/이번주/직접선택</p>
              <div class="guide-warning"><i data-lucide="alert-triangle" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 기한 초과 작업은 빨간색 표시</div>
            </div>
          </div>
        </div>

        <!-- 4. 날짜 네비게이션 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="calendar" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 4. 날짜 이동</h3>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>날짜 이동</h4>
              <p>헤더: 오늘 | ◀ 전날 | ▶ 다음날</p>
              <div class="guide-tip"><i data-lucide="lightbulb" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 이전 날짜의 미완료 작업도 함께 표시됩니다.</div>
            </div>
          </div>
        </div>

        <!-- 5. 팀 관리 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="users" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 5. 팀 관리</h3>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>팀 만들기</h4>
              <p>팀 관리 → 새 팀 만들기 → 팀명 입력 → 6자리 팀코드 공유</p>
              <div class="guide-tip"><i data-lucide="lightbulb" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 기존 작업/현장이 자동으로 팀으로 이전됩니다.</div>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>팀 참여하기</h4>
              <p>팀 관리 → 기존 팀 참여 → 6자리 팀코드 입력</p>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>팀원 초대하기</h4>
              <p>• 방법1: 팀코드 복사하여 전달<br>
                 • 방법2: ID로 직접 초대 (로그인 ID 입력)</p>
              <div class="guide-tip"><i data-lucide="lightbulb" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 초대받은 사람은 팀 관리에서 수락/거절 가능</div>
              <div class="guide-warning"><i data-lucide="alert-triangle" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 다른 팀에 소속된 사용자는 초대할 수 없습니다.</div>
            </div>
          </div>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>초대 수락/거절</h4>
              <p>메뉴(☰) → 팀 관리 (빨간 배지) → 받은 초대 확인 → ✓수락 또는 ✗거절</p>
            </div>
          </div>
        </div>

        <!-- 6. 경로 표시 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="map" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 6. 이동 경로 (자동)</h3>
          <div class="guide-step">
            <div class="guide-step-content">
              <h4>자동 경로 표시</h4>
              <p>작업이 있으면 지도에 자동으로 경로 표시 (위치 권한 필요)<br>
                 → 작업 순서대로 방문하는 최적 경로 + 총 거리/소요시간</p>
            </div>
          </div>
        </div>

        <!-- 7. 팁과 요령 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="lightbulb" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 7. 유용한 팁</h3>
          <div class="guide-tips-list">
            <div class="guide-tip-item">
              <span class="tip-emoji"><i data-lucide="check-circle" style="width: 16px; height: 16px;"></i></span>
              <span>작업 순서 정리 → 자동으로 최적 경로 표시</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji"><i data-lucide="map-pin" style="width: 16px; height: 16px;"></i></span>
              <span>자주 가는 현장은 미리 등록 → 빠른 선택</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji"><i data-lucide="bell" style="width: 16px; height: 16px;"></i></span>
              <span>시험 작업은 자동 일정 생성 → 수동 입력 불필요</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji"><i data-lucide="users" style="width: 16px; height: 16px;"></i></span>
              <span>팀 작업 한눈에 확인 → 업무 분담 용이</span>
            </div>
            <div class="guide-tip-item">
              <span class="tip-emoji"><i data-lucide="smartphone" style="width: 16px; height: 16px;"></i></span>
              <span>모바일 최적화 → 현장에서 편리하게 사용</span>
            </div>
          </div>
        </div>

        <!-- 8. 문의하기 -->
        <div class="guide-section">
          <h3 class="guide-section-title"><i data-lucide="phone" style="width: 20px; height: 20px; vertical-align: text-bottom;"></i> 8. 문의하기</h3>
          <div class="guide-contact">
            <p>문의사항, 개선 제안, 버그 신고는 언제든 연락주세요!</p>
            <div class="contact-info">
              <div class="contact-item">
                <span class="contact-icon"><i data-lucide="mail" style="width: 16px; height: 16px;"></i></span>
                <span>이메일: durian0606@kakao.com</span>
              </div>
              <div class="contact-item">
                <span class="contact-icon"><i data-lucide="message-circle" style="width: 16px; height: 16px;"></i></span>
                <span>카카오톡: @durian0606</span>
              </div>
            </div>
            <div class="guide-tip" style="margin-top: 15px;">
              <i data-lucide="lightbulb" style="width: 16px; height: 16px; vertical-align: text-bottom;"></i> 빠른 응답을 원하시면 카카오톡으로 연락주세요!
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Kakao Map API -->
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=edfe0792f24f219880fc608009d59a0f&libraries=services">

  </script>

  <!-- Firebase SDK -->
  <script type="module">
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
      push,
      onValue,
      update,
      remove
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import {
      getStorage,
      ref as storageRef,
      uploadBytes,
      getDownloadURL,
      deleteObject
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAMv0BmH24fyd0F8CUTkSYSXMlvbcnUXU4",
      authDomain: "work-todo-6ab7f.firebaseapp.com",
      databaseURL: "https://work-todo-6ab7f-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "work-todo-6ab7f",
      storageBucket: "work-todo-6ab7f.firebasestorage.app",
      messagingSenderId: "263893669261",
      appId: "1:263893669261:web:bdce10bec177ff1f67d9c4"
    };
    const app = initializeApp(firebaseConfig);

    // Realtime Database
    const database = getDatabase(app);
    window.db = database;
    window.dbRef = ref;
    window.dbSet = set;
    window.dbPush = push;
    window.dbOnValue = onValue;
    window.dbUpdate = update;
    window.dbRemove = remove;

    // Storage
    const storage = getStorage(app);
    window.storage = storage;
    window.storageRef = storageRef;
    window.storageUploadBytes = uploadBytes;
    window.storageGetDownloadURL = getDownloadURL;
    window.storageDeleteObject = deleteObject;

    window.firebaseReady = true;
    console.log('✅ Firebase Database & Storage initialized');
  </script>

  <script src="script.js?v=Ver.0.9.7"></script>

  <!-- Lucide Icons 초기화 -->
  <script>
    // Lucide 아이콘 초기화
    if (window.lucide) {
      lucide.createIcons();
    }
  </script>
</body>
</html>              
