<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì‘ì—… ê´€ë¦¬</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(135deg, #0d7377 0%, #14ccb8 100%);
      touch-action: pan-y;
    }

    /* ë¡œê·¸ì¸ í™”ë©´ */
    .login-container {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .login-box {
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 400px;
    }

    .login-title {
      font-size: 28px;
      font-weight: 600;
      color: #0d7377;
      margin-bottom: 30px;
      text-align: center;
    }

    .user-list-title {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
      text-align: center;
    }

    .user-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .user-card {
      padding: 20px;
      background: #f5f7fa;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .user-card:hover {
      background: #0d7377;
      color: white;
      border-color: #0d7377;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(13, 115, 119, 0.3);
    }

    .user-card-avatar {
      width: 50px;
      height: 50px;
      background: rgba(13, 115, 119, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 20px;
      margin: 0 auto 10px;
      color: #0d7377;
    }

    .user-card:hover .user-card-avatar {
      background: rgba(255, 255, 255, 0.3);
      color: white;
    }

    .user-card-name {
      font-weight: 500;
      font-size: 15px;
    }

    .admin-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e0e0e0;
    }

    .admin-input {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .admin-input:focus {
      outline: none;
      border-color: #0d7377;
    }

    .admin-btn {
      width: 100%;
      padding: 12px;
      background: #0d7377;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }

    .admin-btn:hover {
      background: #14ccb8;
    }

    /* ë©”ì¸ ì•± */
    .app-container {
      display: none;
      height: 100vh;
      background: #f5f7fa;
    }

    .app-container.active {
      display: flex;
      flex-direction: column;
    }

    .app-header {
      background: linear-gradient(135deg, #0d7377 0%, #14ccb8 100%);
      color: white;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .header-row-1 {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-row-2 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 18px;
    }

    .header-info {
      display: flex;
      flex-direction: column;
    }

    .app-title {
      font-size: 18px;
      font-weight: 600;
    }

    .user-name {
      font-size: 13px;
      opacity: 0.9;
    }

    .header-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    .header-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .main-content {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .left-panel {
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    .date-display {
      font-size: 15px;
      font-weight: 600;
      color: white;
      flex: 1;
    }

    .nav-buttons {
      display: flex;
      gap: 6px;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .task-input-container {
      background: white;
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .task-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .form-row {
      display: flex;
      gap: 10px;
    }

    .task-input {
      flex: 1;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: border 0.2s;
    }

    .task-input:focus {
      outline: none;
      border-color: #0d7377;
    }

    .site-select-btn {
      padding: 14px 24px;
      background: #f5f7fa;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      color: #333;
      transition: all 0.2s;
      white-space: nowrap;
      min-width: 80px;
    }

    .site-select-btn:hover {
      background: #e8eef3;
      border-color: #0d7377;
    }

    .add-btn {
      background: #0d7377;
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
      white-space: nowrap;
      min-width: 80px;
    }

    .add-btn:hover {
      background: #14ccb8;
    }

    .task-container {
      padding: 20px;
    }

    /* ì§€ë„ ì„¹ì…˜ */
    .map-section {
      background: white;
      padding: 20px;
      margin: 0 20px 20px 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      flex: 0 0 auto;
    }

    .map-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .map-section-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    /* ì§€ë„ */
    #map {
      width: 100%;
      height: 400px;
      border-radius: 8px;
      overflow: hidden;
    }

    .task-card {
      background: white;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .task-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
      transform: translateX(4px);
    }

    .task-card.my-task {
      border-left: 4px solid #0d7377;
    }

    .task-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .task-card-body {
      flex: 1;
      min-width: 0;
      display: flex;
      /* ì¶”ê°€ */
      align-items: center;
      /* ì¶”ê°€ */
      gap: 8px;
      /* ì¶”ê°€ */
      flex-wrap: wrap;
      /* ì¶”ê°€ */
    }

    .task-card-footer {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      min-width: 20px;
      border: 2px solid #ccc;
      border-radius: 50%;
      cursor: pointer;
      background: white;
      transition: all 0.2s;
    }

    .task-checkbox:hover {
      border-color: #0d7377;
    }

    .drag-handle {
      cursor: grab;
      padding: 8px 12px;
      color: #999;
      font-size: 18px;
      min-width: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .task-card.completed .drag-handle {
      color: #ccc;
      font-size: 16px;
      cursor: grab;
      padding: 0 4px;
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    .task-checkbox {
      background: #0d7377;
      border-color: #0d7377;
      position: relative;
    }

    .task-card.completed .task-checkbox::after {
      content: 'âœ“';
      position: absolute;
      color: white;
      font-size: 12px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .task-content {
      flex: 1;
      min-width: 0;
    }

    .task-title {
      font-size: 14px;
      color: #333;
      font-weight: 500;
      line-height: 1.5;
    }

    .task-card.completed .task-title {
      color: #999;
      text-decoration: line-through;
    }

    .task-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .task-date {
      font-size: 11px;
      color: #666;
    }

    .date-label {
      font-size: 11px;
      color: #666;
      margin-right: 4px;
    }

    .test-date-label {
      font-size: 12px;
      background: #e8f4f5;
      color: #0d7377;
      padding: 3px 8px;
      border-radius: 8px;
      white-space: nowrap;
    }

    .task-assignee {
      font-size: 12px;
      background: #f0f9f9;
      color: #0d7377;
      padding: 3px 8px;
      border-radius: 8px;
      white-space: nowrap;
    }

    .task-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .person-select-container {
      display: flex;
      flex-direction: column;  /* ì„¸ë¡œ ë°°ì¹˜ë¡œ ë³€ê²½ */
      align-items: flex-end;  /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
      margin-top: 6px;
      margin-left: auto;
      max-width: 100px;
    }

    .select-wrapper {
      display: flex;
      flex-direction: column;  /* ì„¸ë¡œ ë°°ì¹˜ë¡œ ë³€ê²½ */
      gap: 3px;  /* ë ˆì´ë¸”ê³¼ select ì‚¬ì´ ê°„ê²© */
      width: 100%;
    } 

    .select-label {
      font-size: 9px;
      color: #666;
      font-weight: 500;
      text-align: right;  /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
    }

    .assignee-select {
      width: 100%;  /* ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
      padding: 5px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 11px;
      background: white;
      cursor: pointer;
    }

    .assignee-select:focus {
      outline: none;
      border-color: #0d7377;
    }

    .task-actions {
      display: flex;
      gap: 4px;
    }

    .action-btn {
      background: none;
      border: none;
      color: #ccc;
      cursor: pointer;
      padding: 4px;
      font-size: 14px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .action-btn:hover {
      background: #ffe0e0;
      color: #d13438;
    }

    .section-header {
      color: #999;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      margin: 16px 0 8px 0;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      user-select: none;
      padding: 8px;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .section-header:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .section-header.my-work {
      color: #0d7377;
    }

    .section-toggle {
      margin-right: 8px;
      /* ë³€ê²½: margin-left â†’ margin-right */
      font-size: 14px;
      transition: transform 0.3s;
    }

    .section-header.collapsed .section-toggle {
      transform: rotate(-90deg);
    }

    .task-grid.collapsed {
      display: none;
    }

    .section-divider {
      margin: 20px 0;
      border-bottom: 1px solid #e8e8e8;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* ì§€ë„ */
    #map {
      width: 100%;
      height: 100%;
    }

    .map-controls {
      display: flex;
      gap: 10px;
    }

    .map-btn {
      background: #0d7377;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .map-btn:hover {
      background: #14ccb8;
    }

    /* ëª¨ë‹¬ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: #999;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
    }

    /* ì‘ì—… íƒ€ì„ë¼ì¸ ëª¨ë‹¬ */
    .timeline-item {
      padding: 16px;
      background: #f5f7fa;
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .timeline-item.active {
      background: #e8f4f5;
      border-left: 4px solid #0d7377;
    }

    .timeline-work {
      font-size: 15px;
      color: #333;
      font-weight: 500;
    }

    .timeline-date {
      font-size: 13px;
      color: #666;
    }

    /* í˜„ì¥ ì„ íƒ ëª¨ë‹¬ */
    .site-list {
      list-style: none;
      margin-bottom: 20px;
    }

    .site-item {
      padding: 14px;
      background: #f5f7fa;
      border-radius: 8px;
      margin-bottom: 8px;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .site-item:hover {
      background: #e8eef3;
    }

    .site-item-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .site-item-name {
      font-size: 14px;
      color: #333;
      font-weight: 600;
    }

    .site-item-address {
      font-size: 12px;
      color: #666;
    }

    .site-item-delete {
      background: #ffe0e0;
      border: none;
      color: #d13438;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }

    /* ì™„ë£Œ ê¸°í•œ ì„ íƒ ëª¨ë‹¬ */
    .deadline-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .deadline-modal.active {
      display: flex;
    }

    .deadline-modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .deadline-modal-header {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
    }

    .deadline-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .deadline-option {
      padding: 14px 16px;
      background: #f5f7fa;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-size: 15px;
    }

    .deadline-option:hover {
      background: #0d7377;
      color: white;
      border-color: #0d7377;
    }

    .deadline-option-label {
      font-weight: 500;
      display: block;
    }

    .deadline-option-date {
      font-size: 13px;
      opacity: 0.7;
      margin-top: 4px;
    }

    .deadline-custom {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .deadline-date-input {
      flex: 1;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    .deadline-date-input:focus {
      outline: none;
      border-color: #0d7377;
    }

    .deadline-confirm-btn {
      padding: 12px 24px;
      background: #0d7377;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .deadline-confirm-btn:hover {
      background: #14ccb8;
    }

    .deadline-label-container {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      cursor: pointer;
    }

    .deadline-label-text {
      font-size: 12px;
      color: #666;
    }

    .deadline-date-tag {
      display: inline-block;
      padding: 4px 10px;
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .add-site-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .site-list-section {
      margin-top: 20px;
    }

    .site-list-title {
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      #map {
        height: 300px;
      }

      .map-section {
        margin: 10px;
        padding: 15px;
      }

      /* ê¸°í•œ ì´ˆê³¼ ì‘ì—… ìŠ¤íƒ€ì¼ */
      .task-card.overdue {
        border-left: 4px solid #f44336;
        background: #ffebee;
      }

      .task-card.overdue .task-title {
        color: #d32f2f;
        font-weight: 600;
      }

      .deadline-date-tag.overdue {
        background: #f44336;
        color: white;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {

        0%,
        100% {
          opacity: 1;
        }

        50% {
          opacity: 0.7;
        }
      }

      .overdue-warning {
        display: inline-block;
        margin-left: 8px;
        padding: 2px 8px;
        background: #f44336;
        color: white;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        animation: pulse 1.5s infinite;
      }

      /* ì™„ë£Œ ì„¹ì…˜ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
      .task-grid {
        scrollbar-width: thin;
        scrollbar-color: #0d7377 #f5f7fa;
      }

      .task-grid::-webkit-scrollbar {
        width: 8px;
      }

      .task-grid::-webkit-scrollbar-track {
        background: #f5f7fa;
        border-radius: 4px;
      }

      .task-grid::-webkit-scrollbar-thumb {
        background: #0d7377;
        border-radius: 4px;
      }

      .task-grid::-webkit-scrollbar-thumb:hover {
        background: #14ccb8;
      }
    }
  </style>
</head>

<body>
  <!-- ë¡œê·¸ì¸ í™”ë©´ -->
  <div class="login-container" id="loginContainer">
    <div class="login-box">
      <h1 class="login-title">ì‘ì—… ê´€ë¦¬</h1>
      <p class="user-list-title">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
      <div class="user-grid" id="userGrid"></div>

      <div class="admin-section">
        <input type="text" class="admin-input" id="newUserInput" placeholder="ìƒˆ ì‚¬ìš©ì ì¶”ê°€">
        <button class="admin-btn" onclick="addNewUser()">ì¶”ê°€</button>
      </div>
    </div>
  </div>

  <!-- ë©”ì¸ ì•± -->
  <div class="app-container" id="appContainer">
    <div class="app-header">
      <!-- ì²« ë²ˆì§¸ ì¤„: ë¡œê³ , ì‚¬ìš©ì ì •ë³´, í˜„ì¥, ë¡œê·¸ì•„ì›ƒ -->
      <div class="header-row-1">
        <div class="header-left">
          <div class="user-avatar" id="userAvatar"></div>
          <div class="header-info">
            <div class="app-title">ì‘ì—… ê´€ë¦¬</div>
            <div class="user-name" id="headerUserName"></div>
          </div>
        </div>
        <div class="header-right">
          <button class="header-btn" onclick="toggleSiteModal()">ğŸ“ í˜„ì¥ì¶”ê°€</button>
          <button class="header-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>

      <!-- ë‘ ë²ˆì§¸ ì¤„: ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ -->
      <div class="header-row-2">
        <div class="date-display" id="dateDisplay"></div>
        <div class="nav-buttons">
          <button class="nav-btn" onclick="goToToday()">ì˜¤ëŠ˜</button>
          <button class="nav-btn" onclick="changeDate(-1)">â—€</button>
          <button class="nav-btn" onclick="changeDate(1)">â–¶</button>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="left-panel">
        <div class="task-input-container">
          <div class="task-form">
            <div class="form-row">
              <input type="text" class="task-input" id="siteInput" placeholder="í˜„ì¥ëª…">
              <button class="site-select-btn" onclick="toggleSiteSelectModal()">ğŸ“‹ ì„ íƒ</button>
            </div>
            <div class="form-row">
              <input type="text" class="task-input" id="workInput" placeholder="ì‘ì—… ë‚´ìš© ì…ë ¥">
              <button class="add-btn" onclick="addWork()">+ ì¶”ê°€</button>
            </div>
          </div>
        </div>

        <div class="task-container" id="taskContainer"></div>

        <!-- ì§€ë„ ì„¹ì…˜ -->
        <div class="map-section">
          <div class="map-section-header">
            <h3 class="map-section-title">ğŸš— ì´ë™ ê²½ë¡œ</h3>
            <div class="map-controls">
              <button class="map-btn" onclick="showCurrentLocation()">ë‚´ ìœ„ì¹˜</button>
            </div>
          </div>
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì‘ì—… íƒ€ì„ë¼ì¸ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="timelineModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="timelineTitle"></h3>
        <button class="close-btn" onclick="closeTimelineModal()">Ã—</button>
      </div>
      <div id="timelineContent"></div>
    </div>
  </div>

  <!-- í˜„ì¥ ê´€ë¦¬ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="siteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">í˜„ì¥ ì¶”ê°€</h3>
        <button class="close-btn" onclick="toggleSiteModal()">Ã—</button>
      </div>

      <div class="add-site-form">
        <input type="text" class="task-input" id="newSiteName" placeholder="í˜„ì¥ëª… ì…ë ¥">
        <input type="text" class="task-input" id="newSiteAddress" placeholder="ì£¼ì†Œ ì…ë ¥">
        <button class="add-btn" onclick="addSite()">ì €ì¥</button>
      </div>

      <div class="site-list-section">
        <h4 class="site-list-title">ì €ì¥ëœ í˜„ì¥ ëª©ë¡</h4>
        <ul class="site-list" id="siteList"></ul>
      </div>
    </div>
  </div>

  <!-- ì™„ë£Œ ê¸°í•œ ì„ íƒ ëª¨ë‹¬ -->
  <div class="deadline-modal" id="deadlineModal">
    <div class="deadline-modal-content">
      <div class="deadline-modal-header">ì™„ë£Œ ê¸°í•œ ì„ íƒ</div>
      <div class="deadline-options">
        <div class="deadline-option" onclick="selectDeadline('today')">
          <span class="deadline-option-label">ì˜¤ëŠ˜</span>
          <span class="deadline-option-date" id="todayDate"></span>
        </div>
        <div class="deadline-option" onclick="selectDeadline('tomorrow')">
          <span class="deadline-option-label">ë‚´ì¼</span>
          <span class="deadline-option-date" id="tomorrowDate"></span>
        </div>
        <div class="deadline-option" onclick="selectDeadline('thisWeek')">
          <span class="deadline-option-label">ì´ë²ˆì£¼ ì¤‘ (ê¸ˆìš”ì¼)</span>
          <span class="deadline-option-date" id="thisWeekDate"></span>
        </div>
        <div class="deadline-custom">
          <input type="date" class="deadline-date-input" id="customDeadlineInput">
          <button class="deadline-confirm-btn" onclick="selectDeadline('custom')">í™•ì¸</button>
        </div>
      </div>
    </div>
  </div>

  <!-- í˜„ì¥ ì„ íƒ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="siteSelectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">í˜„ì¥ ì„ íƒ</h3>
        <button class="close-btn" onclick="toggleSiteSelectModal()">Ã—</button>
      </div>
      <ul class="site-list" id="siteSelectList"></ul>
    </div>
  </div>

  <!-- Kakao Map API -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=edfe0792f24f219880fc608009d59a0f&libraries=services"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
      push,
      onValue,
      update,
      remove
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyAMv0BmH24fyd0F8CUTkSYSXMlvbcnUXU4",
      authDomain: "work-todo-6ab7f.firebaseapp.com",
      databaseURL: "https://work-todo-6ab7f-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "work-todo-6ab7f",
      storageBucket: "work-todo-6ab7f.firebasestorage.app",
      messagingSenderId: "263893669261",
      appId: "1:263893669261:web:bdce10bec177ff1f67d9c4"
    };
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    window.db = database;
    window.dbRef = ref;
    window.dbSet = set;
    window.dbPush = push;
    window.dbOnValue = onValue;
    window.dbUpdate = update;
    window.dbRemove = remove;
  </script>

  <script>
    let currentDate = new Date();
    let works = {};
    let assignees = [];
    let sites = {};
    let currentUser = null;
    let map = null;
    let currentMarker = null;
    let routeMarkers = [];  // ğŸ†• ì¶”ê°€
    let routeLine = null;    // ğŸ†• ì¶”ê°€
    let draggedElement = null;
    let draggedWorkId = null;
    // ì„¹ì…˜ ì ‘ê¸°/í¼ì¹˜ê¸° ìƒíƒœ
    let sectionStates = {
      myActive: true,
      teamActive: true,
      completed: true
    };
    // ì´ˆê¸°í™”
    window.onload = function() {
      loadAssignees();
      // ì§€ë„ëŠ” ë¡œê·¸ì¸ í›„ì— ì´ˆê¸°í™”
    };
    // ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™”
    function initMap() {
      // ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
      if (typeof kakao === 'undefined' || !kakao.maps) {
        console.error('ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        document.getElementById('map').innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#999;text-align:center;padding:20px;">ì¹´ì¹´ì˜¤ë§µì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';
        // ì¬ì‹œë„
        setTimeout(() => {
          if (typeof kakao !== 'undefined' && kakao.maps) {
            initMap();
          }
        }, 1000);
        return;
      }
      try {
        const container = document.getElementById('map');
        const options = {
          center: new kakao.maps.LatLng(37.5665, 126.9780),
          level: 3
        };
        map = new kakao.maps.Map(container, options);
        // ì§€ë„ íƒ€ì… ì»¨íŠ¸ë¡¤ ì¶”ê°€
        const mapTypeControl = new kakao.maps.MapTypeControl();
        map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
        // ì¤Œ ì»¨íŠ¸ë¡¤ ì¶”ê°€
        const zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
        // ì§€ë„ í¬ê¸° ì¬ì¡°ì • (ëª¨ë°”ì¼ ëŒ€ì‘)
        setTimeout(() => {
          map.relayout();
        }, 100);
        console.log('âœ… ì§€ë„ ì´ˆê¸°í™” ì„±ê³µ!');
      } catch (error) {
        console.error('âŒ ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        document.getElementById('map').innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#999;text-align:center;padding:20px;">ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.</div>';
      }
    }
    // í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ
    window.showCurrentLocation = function() {
      if (!map) {
        alert('ì§€ë„ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const locPosition = new kakao.maps.LatLng(lat, lng);
          if (currentMarker) {
            currentMarker.setMap(null);
          }
          currentMarker = new kakao.maps.Marker({
            position: locPosition,
            map: map
          });
          map.setCenter(locPosition);
          // ì¸í¬ìœˆë„ìš° í‘œì‹œ
          const infowindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;font-size:12px;">í˜„ì¬ ìœ„ì¹˜</div>'
          });
          infowindow.open(map, currentMarker);
        }, function(error) {
          alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          console.error(error);
        });
      } else {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    };
    
}
    };
    
    // ğŸ†• ì´ë™ ê²½ë¡œ í‘œì‹œ í•¨ìˆ˜ ì¶”ê°€ (ì—¬ê¸°ë¶€í„° ì¶”ê°€)
    function displayRouteOnMap() {
      if (!map) {
        console.log('ì§€ë„ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }

      // ê¸°ì¡´ ë§ˆì»¤ì™€ ì„  ì œê±°
      routeMarkers.forEach(marker => marker.setMap(null));
      routeMarkers = [];
      if (routeLine) {
        routeLine.setMap(null);
        routeLine = null;
      }

      // í˜„ì¬ ë‚ ì§œì˜ ë‚´ ì‘ì—… ì¤‘ ë¯¸ì™„ë£Œ ì‘ì—…ë§Œ ê°€ì ¸ì˜¤ê¸°
      const searchDate = currentDate.toISOString().split('T')[0];
      const myWorks = [];

      Object.keys(works).forEach(workId => {
        const work = works[workId];
        
        // ì‹œí—˜ ê´€ë ¨ ì‘ì—…ì¸ ê²½ìš°
        if (work.work === 'ì‹œí—˜' || work.parentWorkId) {
          if (work.date === searchDate && work.assignee === currentUser && !work.completed) {
            myWorks.push({ ...work, id: workId });
          }
        }
        // ì¼ë°˜ ì‘ì—…ì¸ ê²½ìš°
        else {
          if (!work.completed && work.date <= searchDate && work.assignee === currentUser) {
            myWorks.push({ ...work, id: workId });
          }
        }
      });

      if (myWorks.length === 0) {
        console.log('í‘œì‹œí•  ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ì£¼ì†Œë¥¼ ì¢Œí‘œë¡œ ë³€í™˜í•˜ê³  ë§ˆì»¤ í‘œì‹œ
      const geocoder = new kakao.maps.services.Geocoder();
      const positions = [];
      let processedCount = 0;

      myWorks.forEach((work, index) => {
        const site = Object.values(sites).find(s => s.name === work.site);
        
        if (!site || !site.address) {
          processedCount++;
          checkComplete();
          return;
        }

        // ì£¼ì†Œë¡œ ì¢Œí‘œ ê²€ìƒ‰
        geocoder.addressSearch(site.address, function(result, status) {
          if (status === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
            positions.push({ coords, site: work.site, index: index + 1 });

            // ë§ˆì»¤ ìƒì„±
            const marker = new kakao.maps.Marker({
              position: coords,
              map: map
            });

            // ë²ˆí˜¸ í‘œì‹œ ì¸í¬ìœˆë„ìš°
            const infowindow = new kakao.maps.InfoWindow({
              content: `<div style="padding:5px 10px;font-size:12px;font-weight:600;color:#0d7377;">${index + 1}. ${work.site}</div>`,
              removable: false
            });
            infowindow.open(map, marker);

            routeMarkers.push(marker);
          }
          
          processedCount++;
          checkComplete();
        });
      });

      // ëª¨ë“  ì£¼ì†Œ ê²€ìƒ‰ ì™„ë£Œ í›„ ê²½ë¡œ ê·¸ë¦¬ê¸°
      function checkComplete() {
        if (processedCount === myWorks.length && positions.length > 0) {
          // ì¢Œí‘œ ì •ë ¬ (ì›ë˜ ìˆœì„œëŒ€ë¡œ)
          positions.sort((a, b) => a.index - b.index);
          
          // ê²½ë¡œì„  ê·¸ë¦¬ê¸°
          if (positions.length > 1) {
            const linePath = positions.map(p => p.coords);
            routeLine = new kakao.maps.Polyline({
              path: linePath,
              strokeWeight: 4,
              strokeColor: '#0d7377',
              strokeOpacity: 0.7,
              strokeStyle: 'solid'
            });
            routeLine.setMap(map);
          }

          // ì§€ë„ ë²”ìœ„ ì¬ì„¤ì •
          const bounds = new kakao.maps.LatLngBounds();
          positions.forEach(p => bounds.extend(p.coords));
          map.setBounds(bounds);
        }
      }
    }
    // ğŸ†• ì—¬ê¸°ê¹Œì§€ ì¶”ê°€
    
    // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
    function loadAssignees() {
      const assigneesRef = window.dbRef(window.db, 'assignees');
      window.dbOnValue(assigneesRef, (snapshot) => {
        assignees = [];
        const data = snapshot.val();
        if (data) {
          Object.keys(data).forEach(key => {
            assignees.push({
              id: key,
              name: data[key].name
            });
          });
        }
        renderUserGrid();
      });
    }
    // ì‚¬ìš©ì ê·¸ë¦¬ë“œ ë Œë”ë§
    function renderUserGrid() {
      const grid = document.getElementById('userGrid');
      grid.innerHTML = '';
      assignees.forEach(user => {
        const card = document.createElement('div');
        card.className = 'user-card';
        card.onclick = () => login(user.name);
        const avatar = document.createElement('div');
        avatar.className = 'user-card-avatar';
        avatar.textContent = user.name.charAt(0);
        const name = document.createElement('div');
        name.className = 'user-card-name';
        name.textContent = user.name;
        card.appendChild(avatar);
        card.appendChild(name);
        grid.appendChild(card);
      });
    }
    // ìƒˆ ì‚¬ìš©ì ì¶”ê°€
    window.addNewUser = function() {
      const input = document.getElementById('newUserInput');
      const name = input.value.trim();
      if (!name) {
        alert('ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      if (assignees.some(a => a.name === name)) {
        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.');
        return;
      }
      const assigneesRef = window.dbRef(window.db, 'assignees');
      const newAssigneeRef = window.dbPush(assigneesRef);
      window.dbSet(newAssigneeRef, {
        name: name
      });
      input.value = '';
    };
    // ë¡œê·¸ì¸
    window.login = function(userName) {
      currentUser = userName;
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('appContainer').classList.add('active');
      document.getElementById('userAvatar').textContent = userName.charAt(0);
      document.getElementById('headerUserName').textContent = userName;
      updateDateDisplay();
      loadWorks();
      loadSites();
      // ì§€ë„ ì´ˆê¸°í™” - ëª¨ë°”ì¼ ëŒ€ì‘ì„ ìœ„í•´ ì¶©ë¶„í•œ ì§€ì—°
      setTimeout(() => {
        console.log('ğŸ—ºï¸ ì§€ë„ ì´ˆê¸°í™” ì‹œì‘...');
        initMap();
        // ì§€ë„ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸ í›„ ìœ„ì¹˜ í‘œì‹œ
        setTimeout(() => {
          if (map) {
            showCurrentLocation();
          }
        }, 800);
      }, 500);
    };
    // ë¡œê·¸ì•„ì›ƒ
    window.logout = function() {
      currentUser = null;
      document.getElementById('loginContainer').style.display = 'flex';
      document.getElementById('appContainer').classList.remove('active');
    };
    // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ë™
    window.goToToday = function() {
      currentDate = new Date();
      updateDateDisplay();
      renderWorks();
    };
    window.changeDate = function(days) {
      currentDate.setDate(currentDate.getDate() + days);
      updateDateDisplay();
      renderWorks();
    };

    function updateDateDisplay() {
      const options = {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'short'
      };
      document.getElementById('dateDisplay').textContent = currentDate.toLocaleDateString('ko-KR', options);
    }
    window.addWork = function() {
      const site = document.getElementById('siteInput').value.trim();
      const work = document.getElementById('workInput').value.trim();
      if (!site || !work) {
        alert('í˜„ì¥ëª…ê³¼ ì‘ì—… ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      const worksRef = window.dbRef(window.db, 'works');
      const todayStr = currentDate.toISOString().split('T')[0];
      // ì‹œí—˜ ì‘ì—… ë“±ë¡
      const newWorkRef = window.dbPush(worksRef);
      const parentWorkId = newWorkRef.key;
      window.dbSet(newWorkRef, {
        date: todayStr,
        site: site,
        work: work,
        displayWork: work,
        assignee: currentUser,
        completed: false,
        createdAt: new Date().toISOString(),
        deadline: work === 'ì‹œí—˜' ? null : todayStr // ì‹œí—˜ì´ ì•„ë‹Œ ê²½ìš° ê¸°ë³¸ ê¸°í•œì€ ì˜¤ëŠ˜
      });
      // "ì‹œí—˜" ì‘ì—…ì¸ ê²½ìš° ìë™ìœ¼ë¡œ í›„ì† ì‘ì—…ë“¤ ìƒì„±
      if (work === 'ì‹œí—˜') {
        const testDateStr = todayStr;
        // ìº¡í•‘ (ë‹¤ìŒ ì˜ì—…ì¼)
        const cappingDate = addBusinessDays(testDateStr, 1);
        const cappingRef = window.dbPush(worksRef);
        window.dbSet(cappingRef, {
          date: cappingDate,
          site: site,
          work: 'ìº¡í•‘',
          displayWork: 'ìº¡í•‘',
          assignee: currentUser,
          completed: false,
          createdAt: new Date().toISOString(),
          parentWorkId: parentWorkId,
          testDate: testDateStr
        });
        // íƒˆí˜• (2 ì˜ì—…ì¼ í›„)
        const demoldingDate = addBusinessDays(testDateStr, 2);
        const demoldingRef = window.dbPush(worksRef);
        window.dbSet(demoldingRef, {
          date: demoldingDate,
          site: site,
          work: 'íƒˆí˜•',
          displayWork: 'íƒˆí˜•',
          assignee: currentUser,
          completed: false,
          createdAt: new Date().toISOString(),
          parentWorkId: parentWorkId,
          testDate: testDateStr
        });
        // 7ì¼ ê°•ë„ ì‹œí—˜ (ì ˆëŒ€ 7ì¼ í›„)
        const day7Date = addCalendarDays(testDateStr, 7);
        const day7Ref = window.dbPush(worksRef);
        window.dbSet(day7Ref, {
          date: day7Date,
          site: site,
          work: '7ì¼ ê°•ë„ ì‹œí—˜',
          displayWork: '7ì¼ ê°•ë„ ì‹œí—˜',
          assignee: currentUser,
          completed: false,
          createdAt: new Date().toISOString(),
          parentWorkId: parentWorkId,
          testDate: testDateStr
        });
        // 28ì¼ ê°•ë„ ì‹œí—˜ (ì ˆëŒ€ 28ì¼ í›„)
        const day28Date = addCalendarDays(testDateStr, 28);
        const day28Ref = window.dbPush(worksRef);
        window.dbSet(day28Ref, {
          date: day28Date,
          site: site,
          work: '28ì¼ ê°•ë„ ì‹œí—˜',
          displayWork: '28ì¼ ê°•ë„ ì‹œí—˜',
          assignee: currentUser,
          completed: false,
          createdAt: new Date().toISOString(),
          parentWorkId: parentWorkId,
          testDate: testDateStr
        });
      }
      document.getElementById('siteInput').value = '';
      document.getElementById('workInput').value = '';
    };
    // ì‘ì—… ë¡œë“œ
    function loadWorks() {
      const worksRef = window.dbRef(window.db, 'works');
      window.dbOnValue(worksRef, (snapshot) => {
        works = snapshot.val() || {};
        renderWorks();
      });
    }
    // í˜„ì¥ ë¡œë“œ
    function loadSites() {
      const sitesRef = window.dbRef(window.db, 'sites');
      window.dbOnValue(sitesRef, (snapshot) => {
        sites = snapshot.val() || {};
        renderSiteList();
      });
    }

    function renderWorks() {
      const searchDate = currentDate.toISOString().split('T')[0];
      const myWorks = [];
      const teamWorks = [];
      const completedWorks = []; // ì™„ë£Œëœ ì‘ì—… ë³„ë„ ê´€ë¦¬
      Object.keys(works).forEach(workId => {
        const work = works[workId];
        let shouldShow = false;
        // ì™„ë£Œëœ ì‘ì—…ì€ ë³„ë„ë¡œ ì²˜ë¦¬
        if (work.completed) {
          const deadline = work.deadline || work.date;
          const isOverdue = work.completedDate && deadline < work.completedDate;
          completedWorks.push({
            ...work,
            id: workId,
            displayWork: work.displayWork || work.work,
            isOverdue: isOverdue
          });
          return; // ì™„ë£Œ ì‘ì—…ì€ ì—¬ê¸°ì„œ ì²˜ë¦¬ ì¢…ë£Œ
        }
        // ë¯¸ì™„ë£Œ ì‘ì—… í‘œì‹œ ë¡œì§
        // ì‹œí—˜ ê´€ë ¨ ì‘ì—… (ì‹œí—˜, ìº¡í•‘, íƒˆí˜•, ê°•ë„ì‹œí—˜)
        if (work.work === 'ì‹œí—˜' || work.parentWorkId) {
          shouldShow = work.date === searchDate;
        }
        // ì¼ë°˜ ì‘ì—… - ë“±ë¡ì¼ ì´í›„ë©´ í‘œì‹œ
        else {
          shouldShow = work.date <= searchDate;
        }
        if (shouldShow) {
          const deadline = work.deadline || work.date;
          const isOverdue = deadline < searchDate; // ê¸°í•œ ì´ˆê³¼ ì—¬ë¶€
          const visibleWork = {
            ...work,
            id: workId,
            displayWork: work.displayWork || work.work,
            isOverdue: isOverdue
          };
          if (work.assignee === currentUser) {
            myWorks.push(visibleWork);
          } else {
            teamWorks.push(visibleWork);
          }
        }
      });
      // ì™„ë£Œëœ ì‘ì—…ì„ ì™„ë£Œ ë‚ ì§œ ê¸°ì¤€ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
      completedWorks.sort((a, b) => {
        const dateA = a.completedDate || a.date;
        const dateB = b.completedDate || b.date;
        return dateB.localeCompare(dateA);
      });
      const container = document.getElementById('taskContainer');
      container.innerHTML = '';
      // ë‚´ ì‘ì—… ì§„í–‰ ì¤‘
      const myActiveWorks = myWorks.filter(w => !w.completed);
      if (myActiveWorks.length > 0) {
        const header = document.createElement('div');
        header.className = 'section-header my-work' + (sectionStates.myActive ? '' : ' collapsed');
        header.innerHTML = '<span class="section-toggle">â–¼</span> ğŸ“Œ ë‚´ ì‘ì—… ì§„í–‰ ì¤‘ <span style="color: #0d7377; font-weight: 700;">(' + myActiveWorks.length + ')</span>';
        header.onclick = () => toggleSection('myActive');
        container.appendChild(header);
        const grid = document.createElement('div');
        grid.className = 'task-grid' + (sectionStates.myActive ? '' : ' collapsed');
        grid.id = 'myTaskGrid';
        myActiveWorks.forEach(work => {
          grid.appendChild(createWorkCard(work, false));
        });
        container.appendChild(grid);
      }
      // íŒ€ ì‘ì—… ì§„í–‰ ì¤‘
      const teamActiveWorks = teamWorks.filter(w => !w.completed);
      if (teamActiveWorks.length > 0) {
        if (myActiveWorks.length > 0) {
          const divider = document.createElement('div');
          divider.className = 'section-divider';
          container.appendChild(divider);
        }
        const header = document.createElement('div');
        header.className = 'section-header' + (sectionStates.teamActive ? '' : ' collapsed');
        header.innerHTML = '<span class="section-toggle">â–¼</span> ğŸ‘¥ íŒ€ ì‘ì—… ì§„í–‰ ì¤‘ <span style="color: #666; font-weight: 700;">(' + teamActiveWorks.length + ')</span>';
        header.onclick = () => toggleSection('teamActive');
        container.appendChild(header);
        const grid = document.createElement('div');
        grid.className = 'task-grid' + (sectionStates.teamActive ? '' : ' collapsed');
        grid.id = 'teamTaskGrid';
        teamActiveWorks.forEach(work => {
          grid.appendChild(createWorkCard(work, false));
        });
        container.appendChild(grid);
      }
      // ì™„ë£Œëœ ì‘ì—… (í•­ìƒ í‘œì‹œ)
      if (completedWorks.length > 0) {
        if (myActiveWorks.length > 0 || teamActiveWorks.length > 0) {
          const divider = document.createElement('div');
          divider.className = 'section-divider';
          container.appendChild(divider);
        }
        const header = document.createElement('div');
        header.className = 'section-header' + (sectionStates.completed ? '' : ' collapsed');
        header.innerHTML = `<span class="section-toggle">â–¼</span> âœ… ì™„ë£Œë¨ <span style="color: #4caf50; font-weight: 700;">(${completedWorks.length})</span>`;
        header.onclick = () => toggleSection('completed');
        container.appendChild(header);
        const grid = document.createElement('div');
        grid.className = 'task-grid' + (sectionStates.completed ? '' : ' collapsed');
        grid.id = 'completedTaskGrid';
        grid.style.maxHeight = '400px'; // ìµœëŒ€ ë†’ì´ ì„¤ì •
        grid.style.overflowY = 'auto'; // ìŠ¤í¬ë¡¤ ì¶”ê°€
        completedWorks.forEach(work => {
          grid.appendChild(createWorkCard(work, true));
        });
        container.appendChild(grid);
      }
      // ì‘ì—…ì´ í•˜ë‚˜ë„ ì—†ì„ ë•Œ
      if (myWorks.length === 0 && teamWorks.length === 0) {
        const emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        emptyState.innerHTML = `
                    <div class="empty-icon">ğŸ“‹</div>
                    <div>ì´ ë‚ ì§œì— ì˜ˆì •ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>
                `;
        container.appendChild(emptyState);
      }
      
      // ğŸ†• ì´ë™ ê²½ë¡œ í‘œì‹œ
      displayRouteOnMap();
    }
    // ì„¹ì…˜ ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€
    function toggleSection(sectionKey) {
      sectionStates[sectionKey] = !sectionStates[sectionKey];
      renderWorks();
    }
    // ì‘ì—… ì¹´ë“œ ìƒì„±
    function createWorkCard(work, isCompleted) {
      const card = document.createElement('div');
      card.className = 'task-card' + (isCompleted ? ' completed' : '');
      // ê¸°í•œ ì´ˆê³¼ ìŠ¤íƒ€ì¼ ì¶”ê°€
      if (!isCompleted && work.isOverdue) {
        card.classList.add('overdue');
      }
      card.draggable = false;
      card.dataset.workId = work.id;
      if (work.assignee === currentUser) {
        card.classList.add('my-task');
      }
      // ë“œë˜ê·¸ ì´ë²¤íŠ¸
      if (!isCompleted) {
        card.addEventListener('dragstart', handleDragStart);
        card.addEventListener('dragend', handleDragEnd);
        card.addEventListener('dragover', handleDragOver);
        card.addEventListener('drop', handleDrop);
        card.addEventListener('dragleave', handleDragLeave);
      }
      // â‹®â‹® ë“œë˜ê·¸ í•¸ë“¤
      if (!isCompleted) {
        const dragHandle = document.createElement('div');
        dragHandle.className = 'drag-handle';
        dragHandle.textContent = 'â‹®â‹®';
        dragHandle.draggable = true; // í•¸ë“¤ë§Œ ë“œë˜ê·¸ ê°€ëŠ¥
        // í•¸ë“¤ì—ì„œ ë“œë˜ê·¸ ì‹œì‘
        dragHandle.addEventListener('mousedown', (e) => {
          card.draggable = true; // ë“œë˜ê·¸ ì‹œì‘ ì‹œ ì¹´ë“œ í™œì„±í™”
        });
        dragHandle.addEventListener('mouseup', (e) => {
          card.draggable = false; // ë“œë˜ê·¸ ëë‚˜ë©´ ë¹„í™œì„±í™”
        });
        card.appendChild(dragHandle);
      }
      // â—‹ ì²´í¬ë°•ìŠ¤
      const checkbox = document.createElement('div');
      checkbox.className = 'task-checkbox';
      checkbox.onclick = (e) => {
        e.stopPropagation();
        toggleComplete(work.id);
      };
      card.appendChild(checkbox);
      // í˜„ì¥ëª… - ì‘ì—…ë‚´ìš©
      const cardBody = document.createElement('div');
      cardBody.className = 'task-card-body';
      const title = document.createElement('div');
      title.className = 'task-title';
      title.textContent = `${work.site} - ${work.displayWork}`;
      // ê¸°í•œ ì´ˆê³¼ ê²½ê³  í‘œì‹œ
      if (!isCompleted && work.isOverdue) {
        const warningBadge = document.createElement('span');
        warningBadge.className = 'overdue-warning';
        warningBadge.textContent = 'âš ï¸ ê¸°í•œì´ˆê³¼';
        title.appendChild(document.createTextNode(' '));
        title.appendChild(warningBadge);
      }
      if (work.testDate) {
        title.style.cursor = 'pointer';
        title.onclick = (e) => {
          e.stopPropagation();
          showTimeline(work);
        };
      }
      cardBody.appendChild(title);
      // ì‹œí—˜ ì‘ì—…ì´ ì•„ë‹Œ ê²½ìš° ì™„ë£Œ ê¸°í•œ í‘œì‹œ
      if (work.work !== 'ì‹œí—˜' && !work.parentWorkId) {
        const deadlineContainer = document.createElement('div');
        deadlineContainer.className = 'deadline-label-container';
        deadlineContainer.onclick = (e) => {
          e.stopPropagation();
          if (!isCompleted) {
            openDeadlineModal(work.id, work.deadline || work.date);
          }
        };
        const deadlineLabel = document.createElement('span');
        deadlineLabel.className = 'deadline-label-text';
        deadlineLabel.textContent = 'ì™„ë£Œ ê¸°í•œ:';
        const deadlineDate = document.createElement('span');
        deadlineDate.className = 'deadline-date-tag';
        // ê¸°í•œ ì´ˆê³¼ ìŠ¤íƒ€ì¼ ì¶”ê°€
        if (!isCompleted && work.isOverdue) {
          deadlineDate.classList.add('overdue');
        }
        deadlineDate.textContent = work.deadline || work.date;
        deadlineContainer.appendChild(deadlineLabel);
        deadlineContainer.appendChild(deadlineDate);
        cardBody.appendChild(deadlineContainer);
      }
      // ì‹œí—˜ ê´€ë ¨ ì‘ì—…ì¸ ê²½ìš° ì‘ì—…ë“±ë¡ì¼ì í‘œì‹œ
      if (work.testDate) {
        const dateLabel = document.createElement('span');
        dateLabel.className = 'date-label';
        dateLabel.textContent = 'ì‘ì—…ë“±ë¡ì¼ì:';
        cardBody.appendChild(dateLabel);
        const testDateTag = document.createElement('span');
        testDateTag.className = 'test-date-label';
        testDateTag.textContent = work.testDate;
        cardBody.appendChild(testDateTag);
      }
      // ì™„ë£Œëœ ì‘ì—…ì¸ ê²½ìš° ì™„ë£Œ ì •ë³´ í‘œì‹œ
      if (isCompleted && work.completedDate) {
        const completedInfo = document.createElement('div');
        completedInfo.style.cssText = 'margin-top: 8px; font-size: 12px; color: #4caf50;';
        const completedLabel = document.createElement('span');
        completedLabel.textContent = 'âœ“ ì™„ë£Œ: ';
        completedLabel.style.fontWeight = '600';
        const completedDate = document.createElement('span');
        completedDate.textContent = work.completedDate;
        const completedBy = document.createElement('span');
        completedBy.textContent = ` (ë‹´ë‹¹: ${work.assignee || 'ë¯¸ì •'})`;
        completedBy.style.color = '#666';
        completedInfo.appendChild(completedLabel);
        completedInfo.appendChild(completedDate);
        completedInfo.appendChild(completedBy);
        cardBody.appendChild(completedInfo);
      }
      card.appendChild(cardBody);
      // ë‹´ë‹¹ì ì„ íƒ ì˜ì—­ (ì™„ë£Œ/ë¯¸ì™„ë£Œ ëª¨ë‘ í‘œì‹œ)
      const personContainer = document.createElement('div');
      personContainer.className = 'person-select-container';
      // ========== ë‹´ë‹¹ì ì˜ì—­ ==========
      const assigneeWrapper = document.createElement('div');
      assigneeWrapper.className = 'select-wrapper';
      const assigneeLabel = document.createElement('label');
      assigneeLabel.className = 'select-label';
      assigneeLabel.textContent = 'ë‹´ë‹¹ì';
      const assigneeSelect = document.createElement('select');
      assigneeSelect.className = 'assignee-select';
      assigneeSelect.onclick = (e) => e.stopPropagation();
      if (isCompleted) assigneeSelect.disabled = true; // ì™„ë£Œëœ ì‘ì—…ì€ ìˆ˜ì • ë¶ˆê°€
      const assigneeDefaultOption = document.createElement('option');
      assigneeDefaultOption.value = '';
      assigneeDefaultOption.textContent = 'ì„ íƒ';
      assigneeSelect.appendChild(assigneeDefaultOption);
      assignees.forEach(assignee => {
        const option = document.createElement('option');
        option.value = assignee.name;
        option.textContent = assignee.name;
        if (work.assignee === assignee.name) {
          option.selected = true;
        }
        assigneeSelect.appendChild(option);
      });
      if (!isCompleted) {
        assigneeSelect.onchange = () => saveAssignee(work.id, assigneeSelect.value);
      }
      assigneeWrapper.appendChild(assigneeLabel);
      assigneeWrapper.appendChild(assigneeSelect);
      // ì»¨í…Œì´ë„ˆì— ë‹´ë‹¹ì ì¶”ê°€
      personContainer.appendChild(assigneeWrapper);
      card.appendChild(personContainer);
      // ğŸ—‘ï¸ íœ´ì§€í†µ ë²„íŠ¼
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'action-btn';
      deleteBtn.textContent = 'ğŸ—‘ï¸';
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        deleteWork(work.id);
      };
      card.appendChild(deleteBtn);
      return card;
    }

    function handleDragStart(e) {
      draggedElement = e.target.closest('.task-card'); // ì¹´ë“œ ìš”ì†Œ ì°¾ê¸°
      draggedWorkId = draggedElement.dataset.workId;
      draggedElement.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
      document.querySelectorAll('.task-card').forEach(card => {
        card.classList.remove('drag-over');
      });
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
      const target = e.target.closest('.task-card');
      // ê°™ì€ ê·¸ë¦¬ë“œ ë‚´ì—ì„œë§Œ ë“œë¡­ í—ˆìš©
      if (target && target !== draggedElement &&
        target.parentElement === draggedElement.parentElement) {
        e.dataTransfer.dropEffect = 'move';
        target.classList.add('drag-over');
      } else {
        e.dataTransfer.dropEffect = 'none'; // ë‹¤ë¥¸ ê·¸ë¦¬ë“œëŠ” ë¶ˆê°€
      }
      return false;
    }

    function handleDragLeave(e) {
      const target = e.target.closest('.task-card');
      if (target) {
        target.classList.remove('drag-over');
      }
    }

    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }
      const target = e.target.closest('.task-card');
      // ê°™ì€ ê·¸ë¦¬ë“œ ë‚´ì—ì„œë§Œ ë“œë¡­ í—ˆìš©
      if (target && target !== draggedElement &&
        target.parentElement === draggedElement.parentElement) {
        const grid = target.parentNode;
        const allCards = [...grid.children];
        const draggedIndex = allCards.indexOf(draggedElement);
        const targetIndex = allCards.indexOf(target);
        if (draggedIndex < targetIndex) {
          target.parentNode.insertBefore(draggedElement, target.nextSibling);
        } else {
          target.parentNode.insertBefore(draggedElement, target);
        }
        target.classList.remove('drag-over');
      }
      return false;
    }
    // íƒ€ì„ë¼ì¸ í‘œì‹œ
    function showTimeline(work) {
      const modal = document.getElementById('timelineModal');
      const title = document.getElementById('timelineTitle');
      const content = document.getElementById('timelineContent');
      title.textContent = work.site + ' - ì‘ì—… ì¼ì •';
      content.innerHTML = '';
      const testDate = new Date(work.testDate);
      const timeline = [{
          work: 'ì‹œí—˜',
          days: 0
        },
        {
          work: 'ìº¡í•‘',
          days: 1
        },
        {
          work: 'íƒˆí˜•',
          days: 2
        },
        {
          work: '7ì¼ ê°•ë„ ì‹œí—˜',
          days: 7
        },
        {
          work: '28ì¼ ê°•ë„ ì‹œí—˜',
          days: 28
        }
      ];
      const today = new Date().toISOString().split('T')[0];
      timeline.forEach(item => {
        const itemDate = new Date(testDate);
        let addedDays = 0;
        if (item.days <= 2) {
          // ì˜ì—…ì¼ ê¸°ì¤€
          let count = 0;
          while (count < item.days) {
            itemDate.setDate(itemDate.getDate() + 1);
            if (itemDate.getDay() !== 0 && itemDate.getDay() !== 6) {
              count++;
            }
          }
        } else {
          // ì ˆëŒ€ì¼ ê¸°ì¤€
          itemDate.setDate(itemDate.getDate() + item.days);
        }
        const dateStr = itemDate.toISOString().split('T')[0];
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        if (dateStr === today) {
          timelineItem.classList.add('active');
        }
        const workName = document.createElement('div');
        workName.className = 'timeline-work';
        workName.textContent = work.site + ' - ' + item.work;
        const workDate = document.createElement('div');
        workDate.className = 'timeline-date';
        workDate.textContent = dateStr;
        timelineItem.appendChild(workName);
        timelineItem.appendChild(workDate);
        content.appendChild(timelineItem);
      });
      modal.classList.add('active');
    }
    window.closeTimelineModal = function() {
      document.getElementById('timelineModal').classList.remove('active');
    };
    // ì‘ì—… ì™„ë£Œ í† ê¸€
    function toggleComplete(workId) {
      const work = works[workId];
      if (!work) return;
      const workRef = window.dbRef(window.db, `works/${workId}`);
      const isCompleting = !work.completed;
      const updateData = {
        completed: isCompleting
      };
      // ì™„ë£Œ ì²˜ë¦¬í•  ë•Œ ì™„ë£Œ ë‚ ì§œ ì €ì¥
      if (isCompleting) {
        updateData.completedDate = new Date().toISOString().split('T')[0];
      } else {
        // ì™„ë£Œ ì·¨ì†Œí•  ë•Œ ì™„ë£Œ ë‚ ì§œ ì œê±°
        updateData.completedDate = null;
      }
      window.dbUpdate(workRef, updateData);
    }
    // ë‹´ë‹¹ì ì €ì¥
    function saveAssignee(workId, assignee) {
      const workRef = window.dbRef(window.db, `works/${workId}`);
      window.dbUpdate(workRef, {
        assignee: assignee
      });
    }
    // ì‘ì—… ì‚­ì œ
    function deleteWork(workId) {
      const work = works[workId];
      if (!work) return;
      // ì‹œí—˜ ì‘ì—…ì¸ ê²½ìš° ì—°ê´€ ì‘ì—…ë„ í•¨ê»˜ ì‚­ì œí• ì§€ í™•ì¸
      if (work.work === 'ì‹œí—˜') {
        if (!confirm('ì´ ì‹œí—˜ ì‘ì—…ê³¼ ê´€ë ¨ëœ ëª¨ë“  ì‘ì—…(ìº¡í•‘, íƒˆí˜•, 7ì¼ê°•ë„, 28ì¼ê°•ë„)ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        // ì—°ê´€ëœ ëª¨ë“  ì‘ì—… ì‚­ì œ
        Object.keys(works).forEach(id => {
          if (works[id].parentWorkId === workId) {
            const childWorkRef = window.dbRef(window.db, `works/${id}`);
            window.dbRemove(childWorkRef);
          }
        });
      } else {
        if (!confirm('ì´ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      }
      // í˜„ì¬ ì‘ì—… ì‚­ì œ
      const workRef = window.dbRef(window.db, `works/${workId}`);
      window.dbRemove(workRef);
    }
    // í˜„ì¥ ê´€ë¦¬
    window.toggleSiteModal = function() {
      const modal = document.getElementById('siteModal');
      modal.classList.toggle('active');
      if (modal.classList.contains('active')) {
        renderSiteList();
      }
    };
    window.toggleSiteSelectModal = function() {
      const modal = document.getElementById('siteSelectModal');
      modal.classList.toggle('active');
      if (modal.classList.contains('active')) {
        renderSiteSelectList();
      }
    };

    function renderSiteList() {
      const list = document.getElementById('siteList');
      list.innerHTML = '';
      Object.keys(sites).forEach(id => {
        const site = sites[id];
        const li = document.createElement('li');
        li.className = 'site-item';

        const infoDiv = document.createElement('div');
        infoDiv.className = 'site-item-info';

        const name = document.createElement('div');
        name.className = 'site-item-name';
        name.textContent = site.name;

        const address = document.createElement('div');
        address.className = 'site-item-address';
        address.textContent = site.address || 'ì£¼ì†Œ ì—†ìŒ';

        infoDiv.appendChild(name);
        infoDiv.appendChild(address);

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'site-item-delete';
        deleteBtn.textContent = 'ì‚­ì œ';
        deleteBtn.onclick = () => deleteSite(id);

        li.appendChild(infoDiv);
        li.appendChild(deleteBtn);
        list.appendChild(li);
      });
    }

    function renderSiteSelectList() {
      const list = document.getElementById('siteSelectList');
      list.innerHTML = '';
      Object.keys(sites).forEach(id => {
        const site = sites[id];
        const li = document.createElement('li');
        li.className = 'site-item';
        li.onclick = () => selectSite(site.name);
        const name = document.createElement('span');
        name.className = 'site-item-name';
        name.textContent = site.name;
        li.appendChild(name);
        list.appendChild(li);
      });
    }

    function selectSite(siteName) {
      document.getElementById('siteInput').value = siteName;
      toggleSiteSelectModal();
    }
    window.addSite = function() {
      const nameInput = document.getElementById('newSiteName');
      const addressInput = document.getElementById('newSiteAddress');
      const name = nameInput.value.trim();
      const address = addressInput.value.trim();

      if (!name) {
        alert('í˜„ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      if (!address) {
        alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      const sitesRef = window.dbRef(window.db, 'sites');
      const newSiteRef = window.dbPush(sitesRef);
      window.dbSet(newSiteRef, {
        name: name,
        address: address,
        createdAt: new Date().toISOString()
      });

      nameInput.value = '';
      addressInput.value = '';

      alert('í˜„ì¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    };

    function deleteSite(id) {
      if (!confirm('ì´ í˜„ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      const siteRef = window.dbRef(window.db, `sites/${id}`);
      window.dbRemove(siteRef);
    }

    function calculateBusinessDays(startDate, endDate) {
      if (startDate > endDate) return -1;
      let count = 0;
      let curDate = new Date(startDate.getTime());
      while (curDate < endDate) {
        const dayOfWeek = curDate.getDay();
        if (dayOfWeek != 0 && dayOfWeek != 6) count++;
        curDate.setDate(curDate.getDate() + 1);
      }
      return count;
    }

    function calculateAbsoluteDays(startDate, endDate) {
      const oneDay = 24 * 60 * 60 * 1000;
      const diffDays = Math.round((endDate - startDate) / oneDay);
      return diffDays;
    }
    // ì˜ì—…ì¼ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ê³„ì‚° (ì£¼ë§ ì œì™¸)
    function addBusinessDays(startDate, businessDays) {
      const date = new Date(startDate);
      let count = 0;
      while (count < businessDays) {
        date.setDate(date.getDate() + 1);
        // ì£¼ë§(ì¼ìš”ì¼=0, í† ìš”ì¼=6) ì œì™¸
        if (date.getDay() !== 0 && date.getDay() !== 6) {
          count++;
        }
      }
      return date.toISOString().split('T')[0];
    }
    // ì ˆëŒ€ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ê³„ì‚°
    function addCalendarDays(startDate, days) {
      const date = new Date(startDate);
      date.setDate(date.getDate() + days);
      return date.toISOString().split('T')[0];
    }
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('timelineModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('timelineModal')) {
        closeTimelineModal();
      }
    });
    document.getElementById('siteModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('siteModal')) {
        toggleSiteModal();
      }
    });
    document.getElementById('siteSelectModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('siteSelectModal')) {
        toggleSiteSelectModal();
      }
    });
    // Enter í‚¤ ì´ë²¤íŠ¸
    document.getElementById('siteInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('workInput').focus();
      }
    });
    document.getElementById('workInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addWork();
    });
    document.getElementById('newUserInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addNewUser();
    });
    document.getElementById('newSiteName').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addSite();
    });
    // ì™„ë£Œ ê¸°í•œ ê´€ë ¨ ë³€ìˆ˜
    let currentEditingWorkId = null;
    // ì™„ë£Œ ê¸°í•œ ëª¨ë‹¬ ì—´ê¸°
    function openDeadlineModal(workId, currentDeadline) {
      currentEditingWorkId = workId;
      const modal = document.getElementById('deadlineModal');
      // ë‚ ì§œ ì˜µì…˜ ì—…ë°ì´íŠ¸
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      // ì´ë²ˆì£¼ ê¸ˆìš”ì¼ ê³„ì‚°
      const friday = new Date(today);
      const day = today.getDay();
      const diff = (5 - day + 7) % 7;
      friday.setDate(friday.getDate() + (diff === 0 ? 7 : diff));
      document.getElementById('todayDate').textContent = today.toISOString().split('T')[0];
      document.getElementById('tomorrowDate').textContent = tomorrow.toISOString().split('T')[0];
      document.getElementById('thisWeekDate').textContent = friday.toISOString().split('T')[0];
      document.getElementById('customDeadlineInput').value = currentDeadline;
      modal.classList.add('active');
    }
    // ì™„ë£Œ ê¸°í•œ ì„ íƒ
    window.selectDeadline = function(option) {
      if (!currentEditingWorkId) return;
      let selectedDate;
      const today = new Date();
      switch (option) {
        case 'today':
          selectedDate = today.toISOString().split('T')[0];
          break;
        case 'tomorrow':
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);
          selectedDate = tomorrow.toISOString().split('T')[0];
          break;
        case 'thisWeek':
          const friday = new Date(today);
          const day = today.getDay();
          const diff = (5 - day + 7) % 7;
          friday.setDate(friday.getDate() + (diff === 0 ? 7 : diff));
          selectedDate = friday.toISOString().split('T')[0];
          break;
        case 'custom':
          selectedDate = document.getElementById('customDeadlineInput').value;
          if (!selectedDate) {
            alert('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.');
            return;
          }
          break;
      }
      // Firebase ì—…ë°ì´íŠ¸
      const workRef = window.dbRef(window.db, `works/${currentEditingWorkId}`);
      window.dbUpdate(workRef, {
        deadline: selectedDate
      });
      // ëª¨ë‹¬ ë‹«ê¸°
      document.getElementById('deadlineModal').classList.remove('active');
      currentEditingWorkId = null;
    };
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('deadlineModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('deadlineModal')) {
        document.getElementById('deadlineModal').classList.remove('active');
        currentEditingWorkId = null;
      }
    });
  </script>
</body>

</html>
